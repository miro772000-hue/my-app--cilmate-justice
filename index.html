<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>العدالة المناخية - د. مروى حسين إسماعيل</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map for React & GenAI -->
    <script type="importmap">
{
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
       "@google/genai": "https://esm.sh/@google/genai"
      }
    }
</script>

    <!-- Environment Variables Shim -->
    <script>
      window.process = {
        env: {
          API_KEY:"AIzaSyDrOm9rRSU4uGV9GMGg88A1l1B7SsxyVfc", 
          GOOGLE_MAPS_API_KEY: ""
        }
      };
    </script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10b981',
                        secondary: '#059669',
                        accent: '#1e293b',
                        background: '#f8fafc'
                    },
                    fontFamily: {
                        cairo: ['Cairo', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Cairo', sans-serif; overflow-x: hidden; }
        
        /* Scrollbars */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #f8fafc; }
        ::-webkit-scrollbar-thumb { background: #10b981; border-radius: 5px; border: 2px solid #f8fafc; }
        ::-webkit-scrollbar-thumb:hover { background: #059669; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f8fafc; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
        
        .custom-scrollbar-dark::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar-dark::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 10px; }
        .custom-scrollbar-dark::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Animations */
        @keyframes mapFocus {
          0% { opacity: 0; transform: scale(1.1); filter: blur(15px); }
          100% { opacity: 1; transform: scale(1); filter: blur(0); }
        }
        .animate-map-focus { animation: mapFocus 1.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>
<body class="bg-background text-accent">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo, createContext } from 'react';
        import ReactDOM from 'react-dom/client';
        import { GoogleGenAI } from "@google/genai";

        // ==========================================
        // 1. DATA & CONSTANTS
        // ==========================================
        const SECTIONS = [
          {
            id: 'intro',
            type: 'intro',
            title: 'مقدمة عن العدالة المناخية',
            intro: 'تأسيس الوعي بالمبادئ الأخلاقية والقانونية التي تحكم علاقتنا بالكوكب كحق أصيل للإنسان.',
            climateWisdom: 'نحن لا نرث الأرض من أجدادنا، بل نستعيرها من أطفالنا. المسؤولية الأخلاقية هي الدين الذي ندين به للمستقبل.',
            isMapSection: true,
            points: [
              {
                text: 'مفهوم العدالة كإطار أخلاقي',
                definition: 'العدالة المناخية هي مفهوم أخلاقي واجتماعي يركز على التوزيع العادل لآثار تغير المناخ ومسؤوليات مواجهته، مؤكدة أن المجتمعات الأضعف والأقل مساهمة في التسبب بالأزمة هي التي تتحمل أشد عواقبها.',
                causes: ['الاستهلاك غير المستدام في الشمال العالمي', 'غياب المسؤولية الأخلاقية للشركات الكبرى'],
                impacts: ['تضرر الفئات الأضعف التي لم تساهم في التلوث', 'اتساع الفجوة التنموية بين الدول'],
                specificExamples: 'مثال: حق المجتمعات النامية (مثل الهند) في الحصول على تمويل دولي للانتقال للطاقة النظيفة كشرط أساسي لنموها الاقتصادي.',
                mapInfo: {
                  regionName: 'مقر اليونسكو - باريس',
                  type: 'region', lat: 48.85, lng: 2.30, zoom: 15, focusColor: '#10b981', riskLevel: 'low',
                  explanation: 'هنا تُصاغ المبادئ الأخلاقية العالمية التي تربط حقوق الإنسان بالبيئة.',
                  detailedImpacts: [
                    { title: 'ميثاق أخلاقي', description: 'إعلان مبادئ اليونسكو 2017 للعمل المناخي.', icon: 'fa-scale-balanced' },
                    { title: 'التعليم من أجل المناخ', description: 'دمج مفاهيم الاستدامة في المناهج الوطنية عالمياً.', icon: 'fa-book-open-reader' },
                    { title: 'التعاون العلمي', description: 'تبادل البيانات المفتوحة بين الدول لخدمة البشرية.', icon: 'fa-microscope' }
                  ]
                }
              },
              {
                text: 'مبادئ العدالة المناخية والمسؤولية العالمية',
                definition: 'مجموعة القواعد التي تضمن التوزيع العادل للأعباء (التوزيعية)، والمشاركة الشاملة في القرار (الإجرائية)، والاعتراف بحقوق المجتمعات الهشة (الاعتراف).',
                causes: ['التفاوت التاريخي في الانبعاثات بين الدول', 'تهميش أصوات الجنوب العالمي في المفاوضات'],
                impacts: ['إقرار مبدأ المسؤولية المشتركة ولكن المتباينة', 'تأسيس صناديق التمويل المناخي كحق تعويضي وليس منحة'],
                specificExamples: 'مثال: تطبيق مبدأ "المسؤوليات المشتركة ولكن المتباينة" في اتفاقية باريس.',
                mapInfo: {
                  regionName: 'منظمة الأمم المتحدة - جنيف',
                  type: 'region', lat: 46.22, lng: 6.14, zoom: 15, focusColor: '#3b82f6', riskLevel: 'low',
                  explanation: 'مقر مجلس حقوق الإنسان، حيث تُرجمت مبادئ العدالة المناخية إلى قرارات قانونية ملزمة دولياً.',
                  detailedImpacts: [
                    { title: 'العدالة الإجرائية', description: 'حق الجميع في المشاركة في صنع القرار البيئي.', icon: 'fa-users-rectangle' },
                    { title: 'حقوق اللاجئين', description: 'تطوير أطر قانونية لحماية النازحين قسرياً بسبب المناخ.', icon: 'fa-person-walking-luggage' },
                    { title: 'الصحة والمناخ', description: 'الاعتراف بالبيئة النظيفة كحق أساسي من حقوق الإنسان.', icon: 'fa-heart-pulse' }
                  ]
                }
              },
              {
                text: 'العدالة بين الأجيال',
                definition: 'ضمان حق الأجيال القادمة في العيش في كوكب مستقر بيئياً، وعدم تحميلهم تبعات استهلاكنا الحالي.',
                causes: ['استنزاف الموارد الطبيعية بسرعة', 'التوجه نحو الربح السريع على حساب الاستدامة'],
                impacts: ['تهديد حياة الأجيال القادمة', 'حرمانهم من حقوقهم الطبيعية في المياه والهواء النقي'],
                specificExamples: 'مثال: القضايا التاريخية التي رفعها نشطاء شباب ضد حكوماتهم (مثل قضية "نيوباور" في ألمانيا 2021).',
                mapInfo: {
                  regionName: 'محكمة العدل الدولية - لاهاي',
                  type: 'region', lat: 52.08, lng: 4.29, zoom: 16, focusColor: '#8b5cf6', riskLevel: 'medium',
                  explanation: 'تشهد المحكمة اليوم قضايا تاريخية تتعلق بحماية حقوق الأجيال القادمة من التلوث.',
                  detailedImpacts: [
                    { title: 'العدالة البيئية والقانون', description: 'الاعتراف القانوني بالضرر العابر للأجيال.', icon: 'fa-gavel' },
                    { title: 'السوابق القضائية', description: 'إلزام الدول قانونياً بخفض الانبعاثات بناءً على العلم.', icon: 'fa-scale-balanced' },
                    { title: 'الوصاية البيئية', description: 'تمثيل حقوق الأطفال الذين لم يولدوا بعد في المحاكم.', icon: 'fa-baby-carriage' }
                  ]
                }
              }
            ],
            interactiveActivities: {
              individual: { title: 'ميثاق أخلاقي شخصي', task: 'اكتب ميثاقاً من 5 نقاط تلتزم فيه بمبادئ المواطنة البيئية في حياتك اليومية.', icon: 'fa-pen-nib' },
              group: { title: 'محاكاة محكمة الأجيال', task: 'نظموا مناظرة تمثل "حقوق الأجيال القادمة" ضد "مصالح الاستهلاك الحالي".', icon: 'fa-gavel' }
            },
            sources: [
              { name: 'إعلان اليونسكو للمبادئ الأخلاقية', url: 'https://unesdoc.unesco.org/ark:/48223/pf0000260129_ara' },
              { name: 'الأمم المتحدة - قمة الأرض (خلفية تاريخية)', url: 'https://www.un.org/ar/conferences/environment/rio1992' },
              { name: 'مفوضية حقوق الإنسان - المناخ والعدالة', url: 'https://www.ohchr.org/ar/climate-change' },
              { name: 'أهداف التنمية المستدامة - الهدف 13', url: 'https://www.un.org/sustainabledevelopment/ar/climate-change/' }
            ]
          },
          {
            id: 'environmental',
            type: 'environmental',
            isMapSection: true,
            title: 'البعد البيئي: النظم الإيكولوجية',
            intro: 'تحليل الأزمات البيئية الكبرى ومواقعها الجغرافية الأكثر تأثراً بالاحتباس الحراري من منظور علمي ونظمي.',
            climateWisdom: 'الطبيعة لا تخرق قوانينها أبداً؛ نحن من ندفع الثمن حين نتجاهل توازنها. الإنسان ليس سيد الأرض، بل جزء من نسيجها.',
            points: [
              {
                text: 'ذوبان الجليد وارتفاع البحر',
                definition: 'تآكل الكتل الجليدية في القطبين مما يؤدي لفيضانات ساحلية وتهديد للمدن والمجتمعات.',
                causes: ['ارتفاع تركيز غازات الصوبة الخضراء', 'امتصاص المحيطات للحرارة الزائدة'],
                impacts: ['غرق المناطق الساحلية المنخفضة', 'اختلال التيارات البحرية العالمية'],
                specificExamples: 'مثال: ذوبان صفيحة غرينلاند الجليدية الذي وصل لمعدلات غير مسبوقة (فقدان 532 مليار طن في عام واحد)، مما يساهم بشكل مباشر في ارتفاع مستوى سطح البحر ويهدد المدن الساحلية العالمية، كما يؤثر الماء العذب الناتج على ملوحة وتيارات المحيط.',
                mapInfo: {
                  regionName: 'القطب الشمالي (سفالبارد)',
                  type: 'arctic', lat: 78.22, lng: 15.63, zoom: 4, focusColor: '#0ea5e9', riskLevel: 'critical',
                  explanation: 'المنطقة الأكثر تأثراً بالاحترار في العالم (الاحترار القطبي المتسارع).',
                  detailedImpacts: [
                    { title: 'تآكل الموائل', description: 'فقدان الحيوانات القطبية لمناطق عيشها.', icon: 'fa-snowflake' },
                    { title: 'انبعاثات الميثان', description: 'ذوبان التربة الصقيعية يطلق غازات دفيئة مخزنة منذ آلاف السنين.', icon: 'fa-fire' },
                    { title: 'اضطراب التيارات', description: 'تدفق المياه العذبة يهدد بتوقف تيارات المحيط الأطلسي الدافئة.', icon: 'fa-water' }
                  ]
                }
              },
              {
                text: 'التغيرات الهيدرولوجية وأزمة المياه العذبة',
                definition: 'اختلال الدورة المائية الطبيعية للأنهار نتيجة التغير المناخي، مما يؤدي لتذبذب حاد بين الفيضانات الكارثية والجفاف الطويل، مما يهدد استدامة النظم البيئية المائية.',
                causes: ['تغير أنماط سقوط الأمطار في منابع الأنهار (مثل الهضبة الإثيوبية)', 'ارتفاع معدلات البخر وفقدان رطوبة التربة'],
                impacts: ['تدهور نوعية المياه العذبة وارتفاع ملوحتها', 'فقدان التنوع البيولوجي النهري وتهديد الزراعة التقليدية'],
                specificExamples: 'مثال: التقلب الشديد في إيراد نهر النيل وتأثر هضبة الحبشة، حيث تشير النماذج إلى زيادة فترات الجفاف وسنوات الفيضان العالي بشكل متطرف، مما يهدد الأمن المائي والزراعي لدول المصب ويتطلب إدارة تكيفية مشتركة.',
                mapInfo: {
                  regionName: 'منابع النيل - الهضبة الإثيوبية',
                  type: 'river', lat: 9.0, lng: 39.0, zoom: 5, focusColor: '#06b6d4', riskLevel: 'high',
                  explanation: 'تعد هذه المنطقة "خزان المياه" الذي يمر بتغيرات بيئية حادة تؤثر على تدفق النهر كمنظومة بيئية شاملة.',
                  detailedImpacts: [
                    { title: 'تذبذب التدفق', description: 'اختلاف غير متوقع في كميات المياه الواصلة للمصب.', icon: 'fa-water' },
                    { title: 'أمن الطاقة والمياه', description: 'الموازنة الصعبة بين توليد الكهرباء والاحتياجات الزراعية.', icon: 'fa-bolt' },
                    { title: 'تآكل التربة', description: 'الأمطار الغزيرة تؤدي لانجراف التربة الخصبة وتهديد السدود.', icon: 'fa-hill-rockslide' }
                  ]
                }
              },
              {
                text: 'تدهور الغابات المدارية (الأمازون)',
                definition: 'فقدان "رئة الأرض" بسبب الجفاف والحرائق والقطع الجائر، مما يقلل قدرة الكوكب على امتصاص الكربون.',
                causes: ['ارتفاع الحرارة العالمية', 'السياسات الزراعية غير المستدامة'],
                impacts: ['انقراض أنواع نادرة من الكائنات', 'تحول الغابات لمصدر للكربون بدل امتصاصه'],
                specificExamples: 'مثال: حرائق الأمازون المتكررة التي تقرب الغابة من "نقطة التحول" (Tipping Point) لتصبح مصدراً للكربون بدلاً من مخزن له، وتأثير ذلك المباشر على تهجير القبائل الأصلية وتدمير صيدلية العالم الطبيعية.',
                mapInfo: {
                  regionName: 'غابات الأمازون - البرازيل',
                  type: 'region', lat: -3.46, lng: -62.21, zoom: 5, focusColor: '#22c55e', riskLevel: 'high',
                  explanation: 'فقدان التنوع البيولوجي يهدد التوازن الطبيعي للكوكب بأكمله.',
                  detailedImpacts: [
                    { title: 'خسارة التنوع', description: 'انقراض صامت لآلاف الأنواع الحيوية.', icon: 'fa-tree' },
                    { title: 'دور السكان الأصليين', description: 'حراس الغابة الذين يملكون المعرفة التقليدية لحمايتها.', icon: 'fa-user-shield' },
                    { title: 'نقطة اللاعودة', description: 'تحول الغابة المطيرة إلى سافانا جافة بسبب تغير المناخ.', icon: 'fa-temperature-arrow-up' }
                  ]
                }
              }
            ],
            interactiveActivities: {
              individual: { title: 'مراقب البصمة المائية', task: 'احسب استهلاكك المائي اليومي وقارنه بالمتوسط العالمي, ثم اقترح خطة لترشيده.', icon: 'fa-droplet' },
              group: { title: 'خريطة المخاطر المحلية', task: 'ارسموا خريطة تخيلية لمنطقتكم توضح المناطق الأكثر تأثراً بالفيضانات أو الجفاف.', icon: 'fa-map' }
            },
            sources: [
              { name: 'تقارير الهيئة الحكومية الدولية (IPCC)', url: 'https://www.ipcc.ch/languages-2/arabic/' },
              { name: 'برنامج الأمم المتحدة للبيئة (UNEP)', url: 'https://www.unep.org/ar' },
              { name: 'منظمة الأغذية والزراعة (FAO) - المياه', url: 'https://www.fao.org/land-water/ar/' },
              { name: 'اتفاقية التنوع البيولوجي (CBD)', url: 'https://www.cbd.int/convention/' }
            ]
          },
          {
            id: 'political',
            type: 'political',
            isMapSection: true,
            title: 'البعد السياسي: الحوكمة والسيادة',
            intro: 'استكشاف التحديات السياسية والقانونية التي تفرضها الأزمة على سيادة الدول والعلاقات الدولية وتقاسم السلطة.',
            climateWisdom: 'الحدود السياسية لا توقف السحب الملوثة؛ العدالة المناخية تتطلب تضامناً عابراً للحدود لأن الخطر لا يعرف جوازات السفر.',
            points: [
              {
                text: 'السيادة الوطنية للدول الجزرية',
                definition: 'خطر الاختفاء المادي والسياسي لدول كاملة من الخريطة بسبب غرق أراضيها بالكامل.',
                causes: ['الارتفاع المستمر لمنسوب البحر', 'ضعف التزام الدول الصناعية بخفض الانبعاثات'],
                impacts: ['نشوء مفهوم "الدولة الرقمية"', 'ضياع الهوية الثقافية للأوطان المختفية'],
                specificExamples: 'مثال: جهود دولة توفالو في الأمم المتحدة لتعديل القانون الدولي ليسمح لها بالاحتفاظ بسيادتها ومياهها الإقليمية (والحقوق الاقتصادية المرتبطة بها) حتى لو غمرت المياه أراضيها بالكامل، ومبادرة "الأمة الرقمية" لحفظ هويتها في الميتافيرس.',
                mapInfo: {
                  regionName: 'جمهورية توفالو',
                  type: 'region', lat: -7.10, lng: 177.64, zoom: 10, focusColor: '#f43f5e', riskLevel: 'critical',
                  explanation: 'دولة مهددة بالزوال الفيزيائي، مما يطرح تحدياً قانونياً عالمياً غير مسبوق.',
                  detailedImpacts: [
                    { title: 'التهجير السيادي', description: 'البحث عن وطن بديل مع الحفاظ على السيادة.', icon: 'fa-landmark' },
                    { title: 'الحقوق الاقتصادية', description: 'المطالبة بالحفاظ على المناطق البحرية الخالصة حتى لو غرقت اليابسة.', icon: 'fa-ship' },
                    { title: 'التراث الرقمي', description: 'محاولات أرشفة الدولة رقمياً في الميتافيرس للحفاظ على الهوية.', icon: 'fa-vr-cardboard' }
                  ]
                }
              },
              {
                text: 'دبلوماسية المناخ (COP)',
                definition: 'المفاوضات الدولية التي تسعى للتوفيق بين مصالح الدول الغنية والفقيرة في تقاسم أعباء خفض الانبعاثات.',
                causes: ['المسؤولية التاريخية للدول الصناعية', 'تفاوت القدرات الاقتصادية'],
                impacts: ['بطء تنفيذ اتفاقيات المناخ', 'صعوبة الوصول لتوافق حول التمويل'],
                specificExamples: 'مثال: المفاوضات الشاقة في مؤتمرات الأطراف (خاصة COP27 بشرم الشيخ و COP28 بدبي) التي أدت أخيراً لإقرار وتفعيل صندوق "الخسائر والأضرار"، كاعتراف سياسي بمسؤولية الدول الغنية عن تعويض الدول النامية عن الكوارث المناخية التي لا يمكن التكيف معها.',
                mapInfo: {
                  regionName: 'إكسبو سيتي (COP28) - دبي',
                  type: 'region', lat: 24.96, lng: 55.15, zoom: 14, focusColor: '#f59e0b', riskLevel: 'medium',
                  explanation: 'مقر مفاوضات تاريخية بشأن تفعيل صندوق الخسائر والأضرار للدول المتضررة.',
                  detailedImpacts: [
                    { title: 'التوافق العالمي', description: 'تحدي الاتفاق على إجراءات ملزمة للجميع.', icon: 'fa-handshake' },
                    { title: 'صوت الشباب', description: 'تزايد تأثير الحركات الشبابية في الضغط على المفاوضين.', icon: 'fa-bullhorn' },
                    { title: 'الالتزامات الوطنية', description: 'مراجعة تعهدات الدول (NDCs) لخفض الانبعاثات.', icon: 'fa-file-signature' }
                  ]
                }
              },
              {
                text: 'السيادة المائية والجيوسياسية العابرة للحدود',
                definition: 'الصراع السياسي والقانوني على "ملكيات" الموارد المائية، حيث تتقاطع المصالح القومية للدول المتشاركة في الأنهار، مما يحول ندرة المياه (الناتجة عن المناخ) إلى فتيل للأزمات الأمنية والسياسية.',
                causes: ['غياب الاتفاقيات القانونية الملزمة والعادلة', 'استغلال الموارد المائية كأداة للضغط السياسي الإقليمي'],
                impacts: ['خطر اندلاع نزاعات مسلحة على المياه', 'عدم الاستقرار السياسي الإقليمي وتهديد السلم الدولي'],
                specificExamples: 'مثال: التوتر الهيدرو-سياسي في حوض النيل حول "سد النهضة"، كنموذج لكيفية تحول الموارد المائية المتناقصة بفعل المناخ إلى قضية أمن قومي وجودية، تتطلب أطراً قانونية جديدة لتقاسم الضرر أثناء سنوات الجفاف الممتد والحفاظ على الحقوق التاريخية.',
                mapInfo: {
                  regionName: 'سد النهضة - النزاع القانوني',
                  type: 'region', lat: 10.87, lng: 35.10, zoom: 10, focusColor: '#f43f5e', riskLevel: 'critical',
                  explanation: 'بؤرة للنزاع السياسي والجيوسياسي الذي يجسد تحدي "السيادة المائية" في القرن الحادي والعشرين.',
                  detailedImpacts: [
                    { title: 'نزاع السيادة', description: 'الصراع بين حقوق التنمية لدول المنبع والحقوق التاريخية لدول المصب.', icon: 'fa-gavel' },
                    { title: 'التكامل الإقليمي', description: 'فرص الربط الكهربائي وتبادل المنافع كبديل للصراع.', icon: 'fa-plug-circle-check' },
                    { title: 'إدارة الجفاف', description: 'ضرورة وجود آلية قانونية مشتركة لإدارة السد في سنوات الجفاف.', icon: 'fa-faucet-drip' }
                  ]
                }
              }
            ],
            interactiveActivities: {
              individual: { title: 'رسالة لسفير المناخ', task: 'اكتب رسالة مقترحة لمفاوض بلادك في مؤتمر COP القادم تطالب فيها بحماية المناطق الساحلية.', icon: 'fa-paper-plane' },
              group: { title: 'محاكاة COP', task: 'قسموا أنفسكم لدول "صناعية" ودول "نامية" وحاولوا الاتفاق على نسبة خفض الانبعاثات.', icon: 'fa-comments' }
            },
            sources: [
              { name: 'اتفاق باريس - الأمم المتحدة (دليل شامل)', url: 'https://www.un.org/ar/climatechange/paris-agreement' },
              { name: 'آلية الأمن المناخي - الأمم المتحدة (بالعربية)', url: 'https://www.un.org/climatesecuritymechanism/ar' },
              { name: 'مؤتمر COP30 - مستقبل العمل المناخي (بالعربية)', url: 'https://www.un.org/ar/climatechange/cop30' },
              { name: 'الإسكوا - حوكمة الموارد والعدالة المناخية', url: 'https://www.unescwa.org/ar/node/48292' }
            ]
          },
          {
            id: 'economic',
            type: 'economic',
            isMapSection: true,
            title: 'البعد الاقتصادي: التمويل العادل',
            intro: 'دراسة الفجوات المالية والديون البيئية التي تعيق التنمية المستدامة في الجنوب العالمي.',
            climateWisdom: 'يكفي العالم لحاجة الجميع، لكنه لا يكفي لجشع الجميع. الاقتصاد الحقيقي هو الذي ينمو دون أن يلتهم مستقبل أبنائه.',
            points: [
              {
                text: 'صندوق الخسائر والأضرار',
                definition: 'آلية تعويض مالي للدول النامية المتضررة من كوارث مناخية لم تساهم في صنعها تاريخياً.',
                causes: ['الظلم التاريخي في توزيع الانبعاثات الكربونية', 'عجز الدول الفقيرة عن تحمل تكلفة إعادة الإعمار'],
                impacts: ['تخفيف الديون عن الدول المتضررة', 'تحقيق نوع من الإنصاف الاقتصادي الدولي'],
                specificExamples: 'مثال: المطالبات الدولية بإسقاط الديون عن باكستان بعد فيضانات 2022 التي غمرت ثلث مساحة الدولة وتسببت بخسائر تتجاوز 30 مليار دولار، وهو ما يفوق قدرة اقتصادها على التعافي دون دعم خارجي عادل.',
                mapInfo: {
                  regionName: 'إسلام آباد - باكستان',
                  type: 'region', lat: 33.68, lng: 73.04, zoom: 6, focusColor: '#059669', riskLevel: 'high',
                  explanation: 'باكستان ساهمت بأقل من 1% في الانبعاثات لكنها خسرت 30 مليار دولار بسبب المناخ.',
                  detailedImpacts: [
                    { title: 'العدالة المالية', description: 'تحويل الأموال من الملوثين للمتضررين.', icon: 'fa-money-bill-trend-up' },
                    { title: 'مرونة البنية التحتية', description: 'الحاجة لإعادة تصميم المدن لتتحمل الظواهر المتطرفة.', icon: 'fa-bridge-water' },
                    { title: 'عبء الديون', description: 'تفاقم الديون السيادية بسبب تكاليف الكوارث المتكررة.', icon: 'fa-chart-pie' }
                  ]
                }
              },
              {
                text: 'الأمن الغذائي والزراعة المستدامة',
                definition: 'ضمان وصول الغذاء الكافي والمغذي لجميع البشر، وحماية النظم الزراعية والاقتصادية المرتبطة بالغذاء من الانهيار نتيجة الجفاف الشديد وتدهور التربة وارتفاع الأسعار العالمي.',
                causes: ['فشل المحاصيل نتيجة نوبات الجفاف الطويلة', 'اضطراب سلاسل التوريد الزراعية العالمية'],
                impacts: ['ارتفاع حاد في أسعار الغذاء العالمية (التضخم المناخي)', 'المجاعة وسوء التغذية الحاد في الدول النامية'],
                specificExamples: 'مثال عالمي: المجاعة في القرن الأفريقي (الصومال، إثيوبيا، كينيا)، حيث أدى تتابع 5 مواسم جفاف (الأسوأ منذ 40 عاماً) لنفوق الماشية، مما جعل السكان عاجزين عن شراء الغذاء المستورد الذي ارتفعت أسعاره عالمياً.',
                mapInfo: {
                  regionName: 'منطقة القرن الأفريقي (الصومال وكينيا)',
                  type: 'region', lat: 5.15, lng: 46.20, zoom: 5, focusColor: '#f97316', riskLevel: 'critical',
                  explanation: 'مركز أزمة الغذاء العالمية المرتبطة بالمناخ، حيث يعتمد الاقتصاد المحلي كلياً على زراعة مهددة بالجفاف.',
                  detailedImpacts: [
                    { title: 'انهيار الأمن الغذائي', description: 'فقدان سبل العيش لملايين المزارعين والرعاة.', icon: 'fa-wheat-awn-circle-exclamation' },
                    { title: 'الصراع على الموارد', description: 'تحول ندرة العشب والماء إلى نزاعات قبلية ومحلية.', icon: 'fa-shield-cat' },
                    { title: 'التضخم المناخي', description: 'ارتفاع أسعار المواد الأساسية بسبب نقص المعروض عالمياً.', icon: 'fa-arrow-trend-up' }
                  ]
                }
              },
              {
                text: 'الاقتصاد الأخضر والوظائف المستدامة',
                definition: 'التحول من الاقتصاد القائم على النفط إلى اقتصاد يحافظ على البيئة ويخلق فرص عمل جديدة وعادلة.',
                causes: ['الحاجة لتقليل الانبعاثات الكربونية', 'ظهور تقنيات الطاقة المتجددة المربحة'],
                impacts: ['توليد ملايين الوظائف الخضراء', 'تقليل الفقر عبر حلول طاقة رخيصة ونظيفة'],
                specificExamples: 'مثال: شراكات التحول العادل للطاقة (JETP) في جنوب أفريقيا، التي تهدف لاستبدال محطات الفحم بمشاريع طاقة متجددة، مع التركيز على إعادة تدريب عمال المناجم لضمان وظائف بديلة ومستدامة لهم، مما يحقق عدالة اجتماعية واقتصادية.',
                mapInfo: {
                  regionName: 'كيب تاون - جنوب أفريقيا',
                  type: 'region', lat: -33.92, lng: 18.42, zoom: 10, focusColor: '#10b981', riskLevel: 'medium',
                  explanation: 'رائدة أفريقيا في التحول العادل للطاقة (Just Energy Transition).',
                  detailedImpacts: [
                    { title: 'وظائف خضراء', description: 'تمكين الشباب من المهارات التكنولوجية البيئية.', icon: 'fa-briefcase' },
                    { title: 'العدالة الاجتماعية', description: 'ضمان ألا يؤدي التحول الطاقي لفقدان وظائف عمال الفحم.', icon: 'fa-users-gear' },
                    { title: 'الاستثمار المستدام', description: 'جذب رؤوس الأموال لمشاريع صديقة للبيئة.', icon: 'fa-hand-holding-dollar' }
                  ]
                }
              }
            ],
            interactiveActivities: {
              individual: { title: 'ميزانية الأسرة الخضراء', task: 'صمموا ميزانية شهرية بديلة توفر فيها تكاليف الطاقة التقليدية وتستثمرها في حلول مستدامة.', icon: 'fa-coins' },
              group: { title: 'مخطط مشروع تنموي', task: 'اقترحوا مشروعاً صغيراً يعتمد على الاقتصاد الأخضر ويمكن تنفيذه في جامعتكم.', icon: 'fa-lightbulb' }
            },
            sources: [
              { name: 'البنك الدولي - المناخ والتنمية (بالعربية)', url: 'https://www.albankaldawli.org/ar/topic/climatechange' },
              { name: 'الإسكوا - المركز العربي لسياسات تغير المناخ', url: 'https://www.unescwa.org/ar/acccp' },
              { name: 'صندوق النقد الدولي - نقاش تغير المناخ (آفاق جديدة)', url: 'https://www.imf.org/ar/publications/fandd/issues/2024/06/the-imfs-climate-change-debate-masood-ahmed' },
              { name: 'منظمة التجارة العالمية - التجارة والبيئة', url: 'https://www.wto.org/english/tratop_e/envir_e/envir_e.htm' }
            ]
          },
          {
            id: 'social',
            type: 'social',
            isMapSection: true,
            title: 'البعد الاجتماعي: الحقوق والشمول',
            intro: 'تحليل أثر التغير المناخي على النسيج المجتمعي وضمان حماية الفئات الهشة واللاجئين البيئيين وصحة الإنسان.',
            climateWisdom: 'مقياس تحضر الأمم ليس في ارتفاع مبانيها، بل في حمايتها لأضعف فئاتها من غضب الطبيعة. لا عدالة مناخية دون عدالة اجتماعية.',
            points: [
              {
                text: 'تأثر الفئات المهمشة والعدالة الاجتماعية',
                definition: 'عدم المساواة في توزيع الأعباء البيئية، حيث تعاني العمالة غير المنتظمة والمجتمعات التي تعتمد على الموارد الطبيعية من آثار التغير المناخي بشكل مضاعف نتيجة ضعف شبكات الأمان الاجتماعي.',
                causes: ['الاعتماد الاقتصادي المباشر على البيئة المهددة', 'انخفاض القدرة المالية على التكيف مع الكوارث'],
                impacts: ['فقدان مصادر الدخل التقليدية (الصيد، الزراعة البسيطة)', 'زيادة حدة الفقر المائي والغذائي لدى هذه الفئات'],
                specificExamples: 'مثال محلي: معاناة مجتمع الصيادين في "المكس" بالإسكندرية، حيث يؤدي ارتفاع منسوب البحر وتطرف النوات البحرية إلى غرق المنازل الملاصقة للشاطئ وتوقف الصيد لأيام طويلة، مما يهدد الأمن الاقتصادي والاجتماعي للأسر ويهدد باندثار مهنتهم التاريخية.',
                mapInfo: {
                  regionName: 'منطقة المكس - الإسكندرية',
                  type: 'region', lat: 31.14, lng: 29.85, zoom: 14, focusColor: '#3b82f6', riskLevel: 'high',
                  explanation: 'تعد المكس (فينيسيا الشرق) نموذجاً للمجتمعات التي يهدد المناخ نسيجها الاجتماعي وسبل عيشها التاريخية.',
                  detailedImpacts: [
                    { title: 'تهديد المهنة', description: 'تأثر إنتاجية الصيد وتغير حركة الأسماك بسبب حرارة المياه.', icon: 'fa-anchor' },
                    { title: 'التكيف العمراني', description: 'ضرورة تطوير حواجز أمواج وأنظمة صرف متطورة لحماية المنازل.', icon: 'fa-building-shield' },
                    { title: 'شبكات الأمان', description: 'أهمية توفير دعم حكومي للصيادين في فترات توقف الصيد.', icon: 'fa-hands-holding-circle' }
                  ]
                }
              },
              {
                text: 'النزوح البيئي وحقوق الشعوب الأصلية',
                definition: 'التهجير القسري للمجتمعات (لاجئي المناخ) بسبب فقدان موائلها الطبيعية، والتهديد الوجودي للثقافات المرتبطة بالأرض والهوية البيئية.',
                causes: ['غرق الأراضي الساحلية', 'تدهور النظم البيئية الحيوية (مثل ذوبان الجليد)'],
                impacts: ['نشوء ظاهرة "اللاجئين البيئيين" دولياً', 'ضياع المعارف التقليدية واللغات الأصلية المرتبطة بالأرض والهوية البيئية.'],
                specificExamples: 'أمثلة عالمية: نزوح المزارعين في دلتا بنغلاديش بسبب تسرب الملوحة للأراضي الزراعية نتيجة ارتفاع البحر، مما يجبرهم على الهجرة العشوائية للأحياء الفقيرة في المدن (ظاهرة اللاجئين البيئيين)، وفقدان شعب "الإينويت" في القطب الشمالي لمناطق صيدهم التاريخية بسبب ذوبان الجليد.',
                mapInfo: {
                  regionName: 'دلتا بنغلاديش',
                  type: 'region', lat: 23.81, lng: 90.41, zoom: 6, focusColor: '#ef4444', riskLevel: 'critical',
                  explanation: 'واحدة من أكثر مناطق العالم تأثراً بالنزوح السكاني الناتج عن ارتفاع منسوب البحر والفيضانات.',
                  detailedImpacts: [
                    { title: 'اللاجئون البيئيون', description: 'تحول مجتمعات زراعية بالكامل إلى نازحين في المدن.', icon: 'fa-people-roof' },
                    { title: 'العبء على النساء', description: 'النساء يتحملن العبء الأكبر في تأمين المياه والغذاء أثناء الكوارث.', icon: 'fa-person-dress' },
                    { title: 'تملح التربة', description: 'تسرب مياه البحر للأراضي الزراعية يدمر الأمن الغذائي.', icon: 'fa-seedling' }
                  ]
                }
              },
              {
                text: 'الصحة العامة والعدالة المناخية',
                definition: 'الحق العالمي في العيش في بيئة لا تهدد السلامة البدنية، وفهم كيف تؤدي التغيرات المناخية لتفاقم الأوبئة والأمراض المزمنة (الجهاز التنفسي والقلب) للمجتمع ككل.',
                causes: ['تزايد العواصف الترابية ومستويات التلوث الجوي', 'ارتفاع درجات الحرارة القياسية'],
                impacts: ['زيادة العبء على أنظمة الرعاية الصحية', 'تدهور جودة الحياة وزيادة نسب الإصابة بالأمراض الصدرية'],
                specificExamples: 'مثال عالمي: الضباب الدخاني السام في نيودلهي الذي يجبر السلطات على إغلاق المدارس سنوياً، حيث يتفاقم التلوث بسبب الاحتباس الحراري وسكون الرياح، مما يحول الهواء إلى خطر مميت للأطفال وكبار السن، ويبرز التفاوت في القدرة على الحصول على هواء نقي.',
                mapInfo: {
                  regionName: 'نيودلهي - الهند',
                  type: 'region', lat: 28.61, lng: 77.20, zoom: 10, focusColor: '#94a3b8', riskLevel: 'critical',
                  explanation: 'أبرز مثال عالمي على الرابط الكارثي بين المناخ وتدهور الصحة العامة من خلال تلوث الهواء.',
                  detailedImpacts: [
                    { title: 'أزمات التنفس', description: 'ارتفاع حاد في أمراض الرئة والقلب نتيجة جودة الهواء المتدهورة.', icon: 'fa-lungs' },
                    { title: 'الخسائر الاقتصادية', description: 'تريليونات الدولارات تفقد سنوياً بسبب تعطل العمل وتكاليف العلاج.', icon: 'fa-sack-dollar' },
                    { title: 'الإجهاد الحراري', description: 'تأثير موجات الحر القاتلة على العمالة الخارجية والفقراء.', icon: 'fa-temperature-high' }
                  ]
                }
              }
            ],
            interactiveActivities: {
              individual: { title: 'مستكشف قصص النزوح', task: 'ابحث عن قصة واحدة لشخص اضطر لترك منزله بسبب كارثة مناخية وناقش حقوقه المفقودة.', icon: 'fa-id-card' },
              group: { title: 'سفراء العدالة المجتمعية', task: 'صمموا حملة مناصرة رقمية تسلط الضوء على حقوق صيادي المكس واللاجئين البيئيين، مع اقتراح حلول تعليمية لنشر وعي تلاميذكم بهذه القضايا.', icon: 'fa-id-card' }
            },
            sources: [
              { name: 'مفوضية اللاجئين - بناء مستقبل أفضل في ظل تغير المناخ', url: 'https://www.unhcr.org/ar/what-we-do/build-better-futures/climate-change-and-displacement' },
              { name: 'منظمة الصحة العالمية - المناخ والصحة', url: 'https://www.who.int/ar/news-room/fact-sheets/detail/climate-change-and-health' },
              { name: 'الأمم المتحدة - النساء والفتيات في طليعة مكافحة تغيّر المناخ', url: 'https://unsdg.un.org/ar/latest/stories/women-and-girls-leading-fight-against-climate-change' },
              { name: 'الاتحاد الدولي للصليب الأحمر - البوابة العربية', url: 'https://www.ifrc.org/ar' }
            ]
          },
          {
            id: 'technological',
            type: 'technological',
            isMapSection: true,
            title: 'البعد التكنولوجي: الابتكار المناخي',
            intro: 'استخدام التقنيات الحديثة كأدوات لتعزيز الصمود وتحقيق الإنصاف المعلوماتي الرقمي.',
            climateWisdom: 'لن نستطيع حل المشاكل بنفس نوع التفكير الذي صنعها. التكنولوجيا ليست غاية، بل هي الأداة التي يجب أن تخدم إنسانية أكثر وعياً.',
            points: [
              {
                text: 'نظم الإنذار المبكر الذكية',
                definition: 'استخدام الذكاء الاصطناعي والأقمار الصناعية للتنبؤ بالكوارث وإبلاغ المجتمعات قبل وقوعها لتقليل الخسائر البشرية.',
                causes: ['الثورة الرقمية والبيانات الضخمة', 'الحاجة الماسة لتقليل وفيات الكوارث'],
                impacts: ['إنقاذ آلاف الأرواح سنوياً', 'حماية البنية التحتية والممتلكات'],
                specificExamples: 'مثال: استخدام تطبيقات الهواتف البسيطة في كينيا وشرق أفريقيا لإرسال تنبيهات جوية دقيقة للمزارعين والرعاة بلغاتهم المحلية، مما يساعدهم على حماية محاصيلهم ومواشيهم قبل وقوع الفيضانات أو الجفاف، محققاً بذلك "عدالة المعلومات".',
                mapInfo: {
                  regionName: 'نيروبي - كينيا',
                  type: 'region', lat: -1.29, lng: 36.82, zoom: 9, focusColor: '#3b82f6', riskLevel: 'medium',
                  explanation: 'مركز ابتكار تكنولوجي لاستخدام الهواتف في حماية المجتمعات الريفية.',
                  detailedImpacts: [
                    { title: 'تكنولوجيا الصمود', description: 'الوصول للمجتمعات النائية عبر الاتصالات الرقمية.', icon: 'fa-tower-broadcast' },
                    { title: 'ديمقراطية البيانات', description: 'جعل بيانات الطقس متاحة للمزارعين البسطاء مجاناً.', icon: 'fa-mobile-screen' },
                    { title: 'التأمين الزراعي', description: 'ربط بيانات الأقمار الصناعية بصرف تعويضات المزارعين تلقائياً.', icon: 'fa-file-shield' }
                  ]
                }
              },
              {
                text: 'المدن المستدامة والذكية (S-City)',
                definition: 'نماذج حضرية تعتمد على الطاقة النظيفة والنقل الذكي والمباني الخضراء لتقليل البصمة الكربونية.',
                causes: ['الزحف العمراني غير المخطط', 'ارتفاع استهلاك الطاقة في المباني التقليدية'],
                impacts: ['تحسين جودة الحياة للسكان', 'توفير استهلاك الطاقة والمياه بنسبة تصل لـ 50%'],
                specificExamples: 'مثال: مدينة "مصدر" في أبوظبي، التي تستخدم "برج الرياح" التقليدي بتصميم عصري لتبريد الشوارع طبيعياً، وتعتمد بنسبة 100% على الطاقة المتجددة، كنموذج للمدن الصحراوية القابلة للعيش مستقبلاً بأقل بصمة كربونية.',
                mapInfo: {
                  regionName: 'مدينة مصدر - الإمارات',
                  type: 'region', lat: 24.42, lng: 54.61, zoom: 15, focusColor: '#10b981', riskLevel: 'low',
                  explanation: 'مختبر حي لتكنولوجيا المدن التي لا تنتج نفايات أو كربون.',
                  detailedImpacts: [
                    { title: 'النقل النظيف', description: 'استخدام المركبات الكهربائية ذاتية القيادة.', icon: 'fa-car-side' },
                    { title: 'قابلية التوسع', description: 'تحدي تطبيق هذه التقنيات المكلفة في المدن القديمة المكتظة.', icon: 'fa-expand' },
                    { title: 'التبريد السلبي', description: 'استخدام تصاميم معمارية تقلل الحرارة دون مكيفات.', icon: 'fa-wind' }
                  ]
                }
              },
              {
                text: 'نقل التكنولوجيا والتمكين الرقمي',
                definition: 'تجاوز مجرد توفير الأجهزة التقنية إلى بناء القدرات المعرفية والمهارية التي تتيح للمجتمعات النامية ابتكار حلولها الخاصة، مع ضمان الوصول العادل لبراءات الاختراع والبيانات المناخية المفتوحة.',
                causes: ['احتكار الدول الكبرى للتقنيات الخضراء', 'الفجوة الرقمية والمعرفية بين الشمال والجنوب'],
                impacts: ['تسريع التحول العالمي نحو الاستدامة بابتكارات محلية', 'تحقيق السيادة التقنية والمساواة المعرفية'],
                specificExamples: 'مثال: ورش العمل المجتمعية في نيبال التي تستخدم تصميمات "مفتوحة المصدر" لتصنيع وصيانة توربينات مائية وكهربائية صغيرة محلياً، مما يكسر احتكار التكنولوجيا ويمنح القرى النائية استقلالاً طاقياً مستداماً يتناسب مع بيئتهم الجبلية.',
                mapInfo: {
                  regionName: 'كاتماندو - نيبال',
                  type: 'region', lat: 27.71, lng: 85.32, zoom: 11, focusColor: '#f43f5e', riskLevel: 'medium',
                  explanation: 'استخدام تقنيات الطاقة المحلية والمصادر المفتوحة لتمكين القرى الجبلية وبناء قدراتها التقنية.',
                  detailedImpacts: [
                    { title: 'السيادة التقنية', description: 'بناء القدرات المحلية لإنتاج وصيانة التكنولوجيا.', icon: 'fa-microchip' },
                    { title: 'الصيانة المجتمعية', description: 'ضمان استدامة المشاريع عبر تدريب السكان المحليين.', icon: 'fa-wrench' },
                    { title: 'المصادر المفتوحة', description: 'مشاركة المخططات الهندسية عالمياً دون قيود الملكية الفكرية.', icon: 'fa-code-branch' }
                  ]
                }
              }
            ],
            interactiveActivities: {
              individual: { title: 'ناقد التطبيقات الخضراء', task: 'قم باختيار وتقييم أحد التطبيقات التكنولوجية (الموبايل أو الويب) المرتبطة بتقييم الأثر البيئي، ووضح مدى كفاءته في دعم العدالة المناخية.', icon: 'fa-magnifying-glass-chart' },
              group: { title: 'مخطط المدينة المستدامة الذكية', task: 'صمم نموذجاً لحي سكني ذكي يضمن وصول الطاقة الشمسية والإنترنت والمياه النظيفة لكل الفئات بعدالة.', icon: 'fa-city' }
            },
            sources: [
              { name: 'الاتحاد الدولي للاتصالات - التنمية المستدامة', url: 'https://www.itu.int/ar/sustainable-world/pages/default.aspx' },
              { name: 'الوكالة الدولية للطاقة المتجددة (IRENA)', url: 'https://www.irena.org/' },
              { name: 'الاتحاد الدولي للصليب الأحمر - مبادرة الإنذار المبكر للجميع', url: 'https://www.ifrc.org/ar/%D8%A7%D9%84%D8%A5%D9%86%D8%B0%D8%A7%D8%B1-%D8%A7%D9%84%D9%85%D8%A8%D9%83%D8%B1-%D9%84%D9%84%D8%AC%D9%85%D9%8A%D8%B9#:~:text=%D8%A5%D9%86%20%D8%A7%D9%84%D8%A5%D9%86%D8%B0%D8%A7%D8%B1%20%D8%A7%D9%84%D9%85%D8%A8%D9%83%D8%B1-%D9%84%D9%84%D8%AC%D9%85%D9%8A%D8%B9%20(EW4All,%D8%A7%D9%84%D8%A5%D9%86%D8%B0%D8%A7%D8%B1%20%D8%A7%D9%84%D9%85%D8%A8%D9%83%D8%B1%20%D8%A8%D8%AD%D9%84%D9%88%D9%84%20%D8%B9%D8%A7%D9%85%202027.' },
              { name: 'الوكالة الدولية للطاقة - تقارير الانبعاثات الصفرية', url: 'https://www.iea.org/reports/net-zero-by-2050' }
            ]
          }
        ];

        // ==========================================
        // 2. GEMINI SERVICE (Merged from services/geminiService.ts)
        // ==========================================
        class GeminiService {
          constructor() {
            this.modelName = 'gemini-pro';
            this.ai = null;
            this.initialize();
          }

          initialize() {
            const env = window.process?.env || {};
            const apiKey = env.GOOGLE_MAPS_API_KEY || env.API_KEY;
            
            // Only initialize if key is present and not the placeholder
            if (apiKey && apiKey !== "PLACEHOLDER_FOR_VERCEL_ENV") {
                try {
                    this.ai = new GoogleGenAI({ apiKey });
                } catch (e) {
                    console.error("Failed to init AI", e);
                }
            }
          }

          async askAboutClimate(question, history) {
            if (!this.ai) {
                this.initialize();
                if (!this.ai) return { text: "يرجى إضافة مفتاح API في إعدادات Vercel لتفعيل الذكاء الاصطناعي." };
            }

            try {
              const systemInstruction = `
                أنت "المساعد الذكي الشامل" للمنصة التعليمية للدكتورة مروى حسين إسماعيل.
                دورك هو:
                1. الإجابة عن **أي سؤال** يطرحه الطالب يتعلق بموضوعات "العدالة المناخية" (البيئية، السياسية، الاجتماعية، الاقتصادية، التكنولوجية) التي يدرسها في المنصة.
                2. كن مساعداً ذكياً ودوداً، وتحدث باللغة العربية الفصحى.
                3. استخدم المعلومات الواردة في المنهج (أبعاد العدالة المناخية الستة) كأساس لإجاباتك.
                استخدم أداة خرائط جوجل (googleMaps) **فقط** إذا كان السؤال يتطلب تحديد موقع جغرافي أو رؤية مكان معين.
              `;

              const response = await this.ai.models.generateContent({
                model: this.modelName,
                contents: [
                  ...history.map(m => ({
                    role: m.role,
                    parts: [{ text: m.text }]
                  })),
                  { role: 'user', parts: [{ text: question }] }
                ],
                config: {
                  systemInstruction: systemInstruction,
                  tools: [{ googleMaps: {} }],
                  temperature: 0.7,
                }
              });

              let text = response.text || "عذراً، لم أستطع صياغة إجابة حالياً.";
              
              if (history.length === 0) {
                const welcomePhrase = "(أهلاً بك يا طالبنا العزيز في رحاب منصة الدكتورة مروى حسين إسماعيل لتعزيز فهمك للعدالة المناخية)!\n\n";
                text = welcomePhrase + text;
              }

              const groundingChunks = response.candidates?.[0]?.groundingMetadata?.groundingChunks;
              const urls = [];
              
              if (groundingChunks) {
                groundingChunks.forEach((chunk) => {
                  if (chunk.maps) {
                    urls.push({ 
                      title: chunk.maps.title || "عرض الموقع على الخريطة", 
                      uri: chunk.maps.uri 
                    });
                  }
                });
              }

              return { text, urls: urls.length > 0 ? urls : undefined };
            } catch (error) {
              console.error("Gemini API Error:", error);
              return { text: "حدث خطأ أثناء الاتصال بنظام الذكاء الاصطناعي. يرجى التأكد من اتصال الإنترنت وصلاحية مفتاح API." };
            }
          }
        }
        const geminiService = new GeminiService();

        // ==========================================
        // 3. COMPONENTS
        // ==========================================

        // --- Navbar ---
        const Navbar = ({ onSearch, onWebSearch, onPrint, onShare }) => {
          const [searchValue, setSearchValue] = useState('');
          const [activeSection, setActiveSection] = useState('');

          const navLinks = [
            { id: 'intro', label: 'المقدمة', icon: 'fa-book-open' },
            { id: 'environmental', label: 'البيئي', icon: 'fa-leaf' },
            { id: 'political', label: 'السياسي', icon: 'fa-gavel' },
            { id: 'economic', label: 'الاقتصادي', icon: 'fa-chart-line' },
            { id: 'social', label: 'الاجتماعي', icon: 'fa-people-group' },
            { id: 'technological', label: 'التكنولوجي', icon: 'fa-microchip' },
          ];

          const handleSearchChange = (e) => {
            const val = e.target.value;
            setSearchValue(val);
            onSearch(val);
          };

          const scrollToSection = (id) => {
            const element = document.getElementById(id);
            if (element) {
              element.scrollIntoView({ behavior: 'smooth' });
              setActiveSection(id);
            }
          };

          useEffect(() => {
            const handleScroll = () => {
              const scrollPos = window.scrollY + 150;
              for (const link of navLinks) {
                const element = document.getElementById(link.id);
                if (element && scrollPos >= element.offsetTop && scrollPos < element.offsetTop + element.offsetHeight) {
                  setActiveSection(link.id);
                  break;
                }
              }
            };
            window.addEventListener('scroll', handleScroll);
            return () => window.removeEventListener('scroll', handleScroll);
          }, []);

          return (
            <nav className="sticky top-0 z-[100] bg-white/95 backdrop-blur-xl border-b border-gray-100 no-print shadow-sm">
              <div className="max-w-7xl mx-auto px-4 md:px-8">
                <div className="flex justify-between items-center h-16 md:h-20 border-b border-gray-50 md:border-none gap-2 md:gap-4">
                  <div className="flex items-center gap-2 md:gap-3 group cursor-pointer shrink-0" onClick={() => window.scrollTo({top:0, behavior:'smooth'})}>
                    <div className="bg-gradient-to-br from-primary to-secondary p-1.5 md:p-2 rounded-xl text-white shadow-lg shadow-primary/20 group-hover:rotate-12 transition-transform duration-500">
                      <i className="fa-solid fa-leaf text-base md:text-lg"></i>
                    </div>
                    <div className="hidden lg:block">
                      <h1 className="text-lg font-black bg-clip-text text-transparent bg-gradient-to-l from-accent to-primary leading-tight">
                        العدالة المناخية
                      </h1>
                      <p className="text-[9px] text-primary/80 font-black uppercase tracking-wider -mt-1">د. مروى حسين إسماعيل</p>
                    </div>
                    <div className="lg:hidden">
                      <h1 className="text-sm font-black text-accent">العدالة المناخية</h1>
                    </div>
                  </div>

                  <div className="flex-1 max-w-xs md:max-w-sm mx-2 md:mx-8">
                    <div className="relative group">
                      <i className="fa-solid fa-magnifying-glass absolute right-3 md:right-4 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-primary transition-colors text-xs md:text-sm"></i>
                      <input
                        type="text"
                        placeholder="بحث..."
                        className="w-full bg-gray-50 border-2 border-transparent focus:border-primary/20 focus:bg-white rounded-xl py-1.5 md:py-2 pr-9 md:pr-11 pl-4 outline-none transition-all font-bold text-xs"
                        value={searchValue}
                        onChange={handleSearchChange}
                      />
                    </div>
                  </div>

                  <div className="flex items-center gap-1 md:gap-2 shrink-0">
                    <button onClick={onPrint} className="p-1.5 md:p-2 text-gray-500 hover:text-primary hover:bg-primary/5 rounded-lg transition-all hidden sm:block" title="طباعة">
                      <i className="fa-solid fa-print"></i>
                    </button>
                    <button onClick={onShare} className="p-1.5 md:p-2 text-gray-500 hover:text-primary hover:bg-primary/5 rounded-lg transition-all" title="مشاركة">
                      <i className="fa-solid fa-share-nodes"></i>
                    </button>
                    <button onClick={onWebSearch} className="hidden sm:flex items-center gap-2 px-3 py-2 bg-accent text-white rounded-lg text-[10px] font-black hover:bg-slate-700 transition-colors shadow-md">
                      <i className="fa-brands fa-google"></i>
                      <span>بحث خارجي</span>
                    </button>
                  </div>
                </div>

                <div className="flex items-center justify-start md:justify-center gap-2 md:gap-6 py-2 md:py-3 overflow-x-auto no-scrollbar scroll-smooth w-full">
                  {navLinks.map((link) => (
                    <button
                      key={link.id}
                      onClick={() => scrollToSection(link.id)}
                      className={`flex items-center gap-2 px-3 md:px-4 py-1.5 rounded-full whitespace-nowrap transition-all duration-300 shrink-0 ${
                        activeSection === link.id
                        ? 'bg-primary text-white shadow-lg shadow-primary/30 scale-105'
                        : 'bg-gray-50 text-gray-400 hover:text-primary hover:bg-primary/5'
                      }`}
                    >
                      <i className={`fa-solid ${link.icon} text-[10px]`}></i>
                      <span className="text-[10px] md:text-[11px] font-black">{link.label}</span>
                    </button>
                  ))}
                </div>
              </div>
            </nav>
          );
        };

        // --- Interactive Map ---
        const InteractiveMap = ({ selectedPoint, sectionId }) => {
          const [showAnalysis, setShowAnalysis] = useState(false);
          const [activeLandmark, setActiveLandmark] = useState(null);
          const [isFullScreen, setIsFullScreen] = useState(false);

          useEffect(() => {
            setShowAnalysis(false);
            setActiveLandmark(null);
          }, [selectedPoint]);

          useEffect(() => {
            const handleEsc = (e) => {
              if (e.key === 'Escape') setIsFullScreen(false);
            };
            window.addEventListener('keydown', handleEsc);
            return () => {
              window.removeEventListener('keydown', handleEsc);
            };
          }, [isFullScreen]);

          const getMapUrl = () => {
            if (!selectedPoint) return '';
            const { lat, lng, zoom = 6 } = selectedPoint;
            return `https://maps.google.com/maps?q=${lat},${lng}&z=${zoom}&t=k&output=embed&hl=ar`;
          };

          const getLandmarkUrl = (landmark) => {
            return `https://maps.google.com/maps?q=${landmark.lat},${landmark.lng}&z=15&t=k&output=embed&hl=ar`;
          };

          const getRiskLabel = (level) => {
            const isIntro = sectionId === 'intro';
            switch (level) {
              case 'critical': return { text: isIntro ? 'حرج' : 'خطر حرج', color: 'bg-red-500' };
              case 'high': return { text: isIntro ? 'مرتفع' : 'خطر مرتفع', color: 'bg-orange-400' };
              case 'medium': return { text: isIntro ? 'متوسط' : 'خطر متوسط', color: 'bg-amber-400' };
              default: return { text: isIntro ? 'مستقر' : 'خطر مستقر', color: 'bg-emerald-400' };
            }
          };

          const renderMapUI = (full) => {
            if (!selectedPoint) return null;

            return (
              <div className={`relative w-full h-full bg-slate-900 overflow-hidden transition-all duration-700 ${full ? 'rounded-[1.5rem] md:rounded-[2rem]' : 'rounded-[2.5rem]'}`}>
                <iframe
                  key={activeLandmark ? `lm-${activeLandmark.lat}-${activeLandmark.lng}-${full}` : `sp-${selectedPoint.lat}-${selectedPoint.lng}-${full}`}
                  src={activeLandmark ? getLandmarkUrl(activeLandmark) : getMapUrl()}
                  className="w-full h-full border-none animate-map-focus object-cover"
                  allowFullScreen
                  loading="lazy"
                  title="التحليل الجيو-فضائي"
                ></iframe>

                {showAnalysis && (
                  <div className="absolute inset-0 bg-black/40 backdrop-blur-[2px] z-40 transition-opacity duration-500"></div>
                )}

                <div className={`absolute left-4 right-4 md:left-6 md:right-6 z-[60] flex justify-between items-center transition-all duration-500 pointer-events-none ${full ? 'top-6' : 'top-4'}`}>
                  <div className="bg-white/90 backdrop-blur-xl px-4 md:px-5 py-3 rounded-[2rem] shadow-2xl border border-white/50 flex items-center gap-4 pointer-events-auto group/header max-w-[70%] md:max-w-none">
                    <div className={`w-10 h-10 md:w-12 md:h-12 bg-primary text-white rounded-full flex items-center justify-center shadow-lg shadow-primary/30 transition-transform group-hover/header:rotate-12 shrink-0`}>
                      <i className="fa-solid fa-satellite-dish text-base md:text-lg"></i>
                    </div>
                    <div className="text-right overflow-hidden">
                      <h4 className="font-black text-accent text-xs md:text-lg leading-tight truncate">
                        {activeLandmark ? activeLandmark.name : selectedPoint.regionName}
                      </h4>
                      <div className="flex items-center gap-2 mt-1">
                        <span className={`w-2 h-2 rounded-full ${getRiskLabel(selectedPoint.riskLevel).color} animate-pulse shrink-0`}></span>
                        <span className="text-[9px] md:text-[10px] font-black text-slate-500 uppercase tracking-wider truncate">
                          {activeLandmark ? 'رصد دقيق' : getRiskLabel(selectedPoint.riskLevel).text}
                        </span>
                      </div>
                    </div>
                  </div>

                  <div className="flex items-center gap-2 pointer-events-auto">
                     {!full ? (
                        <button 
                          onClick={(e) => {
                            e.stopPropagation();
                            setIsFullScreen(true);
                          }}
                          className="bg-white/90 backdrop-blur-md w-12 h-12 rounded-full border border-white shadow-xl flex items-center justify-center text-accent hover:bg-primary hover:text-white transition-all transform hover:scale-110 active:scale-95 group z-[80]"
                          title="تكبير العرض"
                        >
                          <i className="fa-solid fa-expand text-base"></i>
                        </button>
                     ) : (
                        <button 
                          onClick={(e) => {
                            e.stopPropagation();
                            setIsFullScreen(false);
                          }}
                          className="bg-white/90 backdrop-blur-md w-12 h-12 rounded-full border border-white shadow-xl flex items-center justify-center text-red-500 hover:bg-red-500 hover:text-white transition-all transform hover:scale-110 active:scale-90"
                          title="إغلاق"
                        >
                          <i className="fa-solid fa-xmark text-lg"></i>
                        </button>
                     )}
                  </div>
                </div>

                {selectedPoint.landmarks && (
                  <div className={`absolute bottom-6 left-6 z-[55] transition-all duration-700 ease-out ${full ? 'translate-y-0 opacity-100' : 'translate-y-4 opacity-0 md:translate-y-0 md:opacity-100 pointer-events-none md:pointer-events-auto'}`}>
                    <div className="bg-slate-900/80 backdrop-blur-xl p-4 rounded-[2.5rem] border border-white/10 shadow-2xl w-64 md:w-72 pointer-events-auto">
                      <div className="px-4 py-2 border-b border-white/5 mb-3 flex items-center gap-2">
                        <i className="fa-solid fa-location-crosshairs text-primary"></i>
                        <span className="text-[10px] font-black text-white/50 uppercase">المحطات الميدانية</span>
                      </div>
                      <div className="space-y-1.5 max-h-48 overflow-y-auto custom-scrollbar-dark px-1">
                        {selectedPoint.landmarks.map((landmark, i) => (
                          <button 
                            key={i} 
                            onClick={(e) => {
                              e.stopPropagation();
                              setActiveLandmark(landmark);
                              setShowAnalysis(true);
                            }}
                            className={`w-full text-right p-3 rounded-2xl transition-all border-2 flex items-center gap-3 ${
                              activeLandmark === landmark 
                              ? 'border-primary bg-primary/20 text-white' 
                              : 'border-transparent bg-white/5 hover:bg-white/10 text-white/70'
                            }`}
                          >
                            <span className={`w-2 h-2 rounded-full ${activeLandmark === landmark ? 'bg-primary' : 'bg-white/20'}`}></span>
                            <span className="text-[11px] font-black truncate">{landmark.name}</span>
                          </button>
                        ))}
                        {activeLandmark && (
                          <button 
                            onClick={(e) => {
                              e.stopPropagation();
                              setActiveLandmark(null);
                            }}
                            className="w-full py-2.5 text-[10px] font-black text-red-400 bg-red-400/10 rounded-xl mt-2 hover:bg-red-400/20 transition-colors"
                          >
                            إعادة ضبط المسح
                          </button>
                        )}
                      </div>
                    </div>
                  </div>
                )}

                <button 
                  onClick={(e) => {
                    e.stopPropagation();
                    setShowAnalysis(!showAnalysis);
                  }}
                  className={`absolute bottom-8 right-8 z-[100] transition-all duration-500 ${showAnalysis ? 'bg-primary scale-110' : 'bg-accent'} text-white px-6 md:px-8 py-3 md:py-4 rounded-full shadow-[0_15px_40px_rgba(0,0,0,0.6)] font-black text-xs md:text-sm flex items-center gap-3 hover:scale-105 active:scale-95 border border-white/20`}
                >
                  <i className={`fa-solid ${showAnalysis ? 'fa-times' : 'fa-chart-pie'}`}></i>
                  <span>{showAnalysis ? 'إغلاق المرصد' : 'فتح مرصد البيانات'}</span>
                </button>

                <div 
                  className={`absolute top-0 right-0 h-full z-[65] transition-all duration-700 ease-[cubic-bezier(0.23,1,0.32,1)] transform ${
                    showAnalysis ? 'translate-x-0' : 'translate-x-full'
                  } ${full ? 'w-full md:w-[600px]' : 'w-[95%] md:w-[500px]'}`}
                >
                  <div className="h-full bg-white/95 backdrop-blur-3xl shadow-[-10px_0_50px_rgba(0,0,0,0.4)] border-l-[12px] flex flex-col" style={{ borderLeftColor: selectedPoint.focusColor }}>
                    <div className={`p-8 md:p-10 pb-4 ${full ? 'pt-28' : 'pt-24'}`}>
                      <div className="flex items-center gap-3 mb-2">
                         <div className="w-8 h-1 bg-primary rounded-full"></div>
                         <span className="text-[10px] font-black text-primary uppercase tracking-[0.2em]">Data Analysis</span>
                      </div>
                      <h4 className="font-black text-accent text-3xl leading-tight">
                        {activeLandmark ? activeLandmark.name : 'مرصد البيانات'}
                      </h4>
                    </div>
                    
                    <div className="flex-1 overflow-y-auto px-8 md:px-10 pb-12 space-y-6 custom-scrollbar">
                      <div className="bg-slate-50 p-6 rounded-[2rem] border border-slate-100 text-sm md:text-base font-bold text-slate-600 leading-relaxed shadow-inner italic">
                        {activeLandmark ? activeLandmark.description : selectedPoint.explanation}
                      </div>

                      <div className="space-y-4">
                        {selectedPoint.detailedImpacts?.map((impact, i) => (
                          <div key={i} className="flex gap-4 p-5 bg-white rounded-[2rem] border border-slate-50 shadow-sm hover:shadow-xl transition-all group/card">
                            <div className="w-12 h-12 rounded-2xl bg-primary/10 flex items-center justify-center text-primary shrink-0 text-xl group-hover/card:scale-110 transition-transform">
                              <i className={`fa-solid ${impact.icon}`}></i>
                            </div>
                            <div>
                              <h6 className="font-black text-accent text-sm md:text-base mb-1">{impact.title}</h6>
                              <p className="text-slate-500 text-[10px] md:text-xs font-bold leading-relaxed">{impact.description}</p>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          return (
            <>
              <div className="relative w-full aspect-[16/9] md:aspect-[21/9] bg-slate-900 rounded-[3rem] overflow-hidden border-[6px] border-white shadow-2xl group/main z-0">
                {selectedPoint ? renderMapUI(false) : (
                  <div className="h-full flex items-center justify-center">
                     <div className="text-center">
                        <div className="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-6 text-white/10 text-3xl animate-pulse">
                          <i className="fa-solid fa-map-pin"></i>
                        </div>
                        <p className="font-black text-white/20 text-xs tracking-widest uppercase">بانتظار تفعيل إحداثيات الموقع</p>
                     </div>
                  </div>
                )}
                
                {selectedPoint && (
                  <button 
                    onClick={() => setIsFullScreen(true)}
                    className="absolute inset-0 z-10 w-full h-full cursor-pointer opacity-0"
                    aria-label="تكبير الخريطة"
                  />
                )}

                {selectedPoint && (
                  <div className="absolute inset-0 z-0 bg-primary/20 opacity-0 group-hover/main:opacity-100 transition-opacity pointer-events-none flex items-center justify-center">
                    <div className="bg-white px-6 py-3 rounded-full text-primary font-black text-sm shadow-2xl scale-0 group-hover/main:scale-100 transition-transform delay-100">
                       انقر للتكبير وبدء التحليل <i className="fa-solid fa-maximize ml-2"></i>
                    </div>
                  </div>
                )}
              </div>

              {isFullScreen && selectedPoint && (
                <div className="fixed inset-0 z-[9999] flex items-center justify-center p-2 md:p-6 no-print">
                  <div 
                    className="absolute inset-0 bg-slate-950/95 backdrop-blur-md animate-in fade-in duration-300"
                    onClick={() => setIsFullScreen(false)}
                  ></div>
                  
                  <div className="relative w-full h-full bg-slate-900 rounded-[2rem] shadow-2xl overflow-hidden border border-white/10 animate-in zoom-in-95 slide-in-from-bottom-8 duration-500 ease-[cubic-bezier(0.25,1,0.5,1)] flex flex-col">
                    {renderMapUI(true)}
                  </div>
                </div>
              )}
            </>
          );
        };

        // --- SectionCard ---
        const SectionCard = ({ section, onShowSources }) => {
          const [selectedPointIndex, setSelectedPointIndex] = useState(0);
          const [completedActivities, setCompletedActivities] = useState({ individual: false, group: false });
          const [showWisdom, setShowWisdom] = useState(false);

          const toggleActivity = (type) => {
            setCompletedActivities(prev => ({ ...prev, [type]: !prev[type] }));
          };

          const currentPoint = section.points[selectedPointIndex];

          const getColorClass = (type) => {
            switch (type) {
              case 'social': return 'bg-purple-50 text-purple-600 border-purple-100';
              case 'technological': return 'bg-blue-50 text-blue-600 border-blue-100';
              case 'economic': return 'bg-amber-50 text-amber-600 border-amber-100';
              case 'political': return 'bg-slate-50 text-slate-600 border-slate-100';
              case 'intro': return 'bg-emerald-50 text-emerald-600 border-emerald-100';
              case 'environmental': return 'bg-emerald-50 text-emerald-600 border-emerald-100';
              default: return 'bg-primary/5 text-primary border-primary/10';
            }
          };

          const isAllDone = completedActivities.individual && completedActivities.group;

          return (
            <section id={section.id} className="bg-white rounded-[2.5rem] md:rounded-[4rem] p-5 md:p-12 shadow-sm border border-gray-100 scroll-mt-24 transition-all hover:shadow-xl hover:shadow-primary/5 relative overflow-hidden">
              <div className="absolute top-0 right-0 w-64 h-64 bg-primary/5 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl pointer-events-none"></div>

              <div className="flex flex-col md:flex-row gap-6 md:gap-8 items-start mb-8 md:mb-12 relative z-10">
                <div className={`w-16 h-16 md:w-20 md:h-20 rounded-2xl md:rounded-3xl flex items-center justify-center text-2xl md:text-3xl border-2 shadow-inner shrink-0 ${getColorClass(section.type)}`}>
                  <i className={`fa-solid ${section.id === 'intro' ? 'fa-book-open' : section.id === 'environmental' ? 'fa-leaf' : section.id === 'political' ? 'fa-gavel' : section.id === 'economic' ? 'fa-chart-line' : section.id === 'social' ? 'fa-people-group' : 'fa-microchip'}`}></i>
                </div>
                <div className="flex-1">
                  <div className="flex justify-between items-start">
                    <div>
                      <h2 className="text-2xl md:text-4xl font-black text-accent mb-2 md:mb-3">{section.title}</h2>
                      <p className="text-gray-500 font-bold text-sm md:text-lg leading-relaxed">{section.intro}</p>
                    </div>
                  </div>
                </div>
              </div>

              <div className="grid lg:grid-cols-12 gap-8 relative z-10 items-start">
                
                <div className="lg:col-span-4 flex flex-col gap-3 md:gap-4 lg:sticky lg:top-24">
                  <p className="text-[10px] md:text-[11px] font-black text-gray-400 uppercase tracking-widest px-2 mb-1 md:mb-2">اختر موضوعاً للعرض التفصيلي:</p>
                  {section.points.map((point, idx) => (
                    <button
                      key={idx}
                      onClick={() => setSelectedPointIndex(idx)}
                      className={`w-full text-right p-4 md:p-6 rounded-[1.5rem] md:rounded-[2rem] border-2 transition-all duration-300 flex items-center justify-between group relative overflow-hidden ${
                        selectedPointIndex === idx 
                        ? 'border-primary bg-primary text-white shadow-xl shadow-primary/20 scale-[1.02] z-10' 
                        : 'border-gray-100 bg-white hover:border-primary/30 hover:bg-gray-50 text-gray-500'
                      }`}
                    >
                      <div className="flex items-center gap-3 md:gap-4 relative z-10">
                        <span className={`w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center font-black text-xs md:text-sm shrink-0 transition-transform duration-500 ${selectedPointIndex === idx ? 'bg-white text-primary' : 'bg-gray-100 text-gray-400 group-hover:bg-white group-hover:text-primary'}`}>
                          {idx + 1}
                        </span>
                        <span className={`font-black text-xs md:text-sm md:text-base leading-tight ${selectedPointIndex === idx ? 'text-white' : 'text-accent'}`}>{point.text}</span>
                      </div>
                      
                      {selectedPointIndex === idx && (
                        <i className="fa-solid fa-arrow-left text-white/50 text-base md:text-xl animate-pulse"></i>
                      )}
                    </button>
                  ))}
                </div>

                <div className="lg:col-span-8">
                  <div className="bg-gray-50/50 backdrop-blur-sm rounded-[2rem] md:rounded-[3rem] p-2 border border-gray-100/50 min-h-[400px] md:min-h-[600px] transition-all duration-500">
                    <div key={selectedPointIndex} className="animate-in fade-in slide-in-from-right-8 duration-500 space-y-4 md:space-y-6 p-2 md:p-6">
                      
                      <div className="flex items-center gap-3 mb-2 px-2">
                        <span className="w-8 md:w-12 h-1 bg-primary rounded-full"></span>
                        <h3 className="text-lg md:text-2xl font-black text-accent">{currentPoint.text}</h3>
                      </div>

                      <div className="bg-white p-5 md:p-6 rounded-[2rem] md:rounded-[2.5rem] border border-gray-100 shadow-sm relative overflow-hidden">
                         <div className="flex items-center gap-2 text-primary font-black text-[10px] md:text-xs uppercase mb-2 md:mb-3">
                           <i className="fa-solid fa-quote-right"></i> المفهوم العلمي
                         </div>
                         <p className="text-gray-600 font-bold text-sm md:text-lg leading-relaxed">{currentPoint.definition}</p>
                      </div>

                      <div className="grid md:grid-cols-2 gap-4">
                        <div className="bg-orange-50/60 p-4 md:p-5 rounded-[1.5rem] md:rounded-[2rem] border border-orange-100">
                          <div className="text-orange-600 font-black text-[10px] md:text-xs uppercase mb-2 md:mb-3 flex items-center gap-2">
                            <i className="fa-solid fa-list-ul"></i> العوامل المسببة
                          </div>
                          <ul className="space-y-2">
                            {currentPoint.causes?.map((c, i) => (
                              <li key={i} className="text-xs md:text-sm font-bold text-gray-700 flex items-start gap-2">
                                <span className="w-1.5 h-1.5 bg-orange-400 rounded-full mt-1.5 shrink-0"></span>
                                {c}
                              </li>
                            ))}
                          </ul>
                        </div>
                        <div className="bg-red-50/60 p-4 md:p-5 rounded-[1.5rem] md:rounded-[2rem] border border-red-100">
                          <div className="text-red-600 font-black text-[10px] md:text-xs uppercase mb-2 md:mb-3 flex items-center gap-2">
                            <i className="fa-solid fa-house-crack"></i> التداعيات والآثار
                          </div>
                          <ul className="space-y-2">
                            {currentPoint.impacts?.map((imp, i) => (
                              <li key={i} className="text-xs md:text-sm font-bold text-gray-700 flex items-start gap-2">
                                <span className="w-1.5 h-1.5 bg-red-400 rounded-full mt-1.5 shrink-0"></span>
                                {imp}
                              </li>
                            ))}
                          </ul>
                        </div>
                      </div>

                      <div className="bg-slate-800 text-white p-5 md:p-6 rounded-[1.5rem] md:rounded-[2rem] border-r-4 border-primary relative overflow-hidden">
                         <div className="flex items-center gap-2 font-black text-[10px] md:text-xs uppercase mb-2 text-primary/90">
                           <i className="fa-solid fa-magnifying-glass-location"></i> مثال واقعي
                         </div>
                         <p className="text-sm md:text-base font-bold leading-relaxed">{currentPoint.specificExamples}</p>
                      </div>

                      {currentPoint.mapInfo && (
                        <div className="rounded-[2rem] md:rounded-[2.5rem] overflow-hidden border-4 border-white shadow-xl bg-white relative z-0">
                          <div className="absolute top-4 right-4 z-10 bg-white/90 backdrop-blur px-3 py-1.5 md:px-4 md:py-2 rounded-full shadow-lg border border-gray-100">
                            <span className="text-[9px] md:text-[10px] font-black text-accent uppercase tracking-wider flex items-center gap-2">
                              <i className="fa-solid fa-location-dot text-primary"></i>
                              الموقع الجغرافي
                            </span>
                          </div>
                          <InteractiveMap 
                            selectedPoint={currentPoint.mapInfo} 
                            sectionId={section.id}
                          />
                        </div>
                      )}

                    </div>
                  </div>
                </div>
              </div>

              {section.climateWisdom && (
                <div className="mt-16 md:mt-24 flex flex-col items-center justify-center">
                   {!showWisdom ? (
                     <button 
                       onClick={() => setShowWisdom(true)}
                       className="group relative inline-flex items-center justify-center gap-3 px-8 py-3 bg-amber-50 text-amber-700 font-black text-sm md:text-base rounded-full border-2 border-amber-200 hover:bg-amber-100 hover:scale-105 active:scale-95 transition-all shadow-lg hover:shadow-amber-200/50"
                     >
                       <i className="fa-solid fa-lightbulb text-amber-500 animate-pulse"></i>
                       <span>استمع إلى حكيم المناخ</span>
                       <div className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-ping"></div>
                     </button>
                   ) : (
                     <div className="max-w-3xl w-full animate-in zoom-in-50 duration-500">
                       <div className="bg-gradient-to-br from-amber-50 to-orange-50 border-2 border-amber-200 rounded-[2.5rem] p-8 md:p-10 relative overflow-hidden shadow-xl text-center cursor-pointer hover:shadow-2xl transition-shadow" onClick={() => setShowWisdom(false)}>
                         <div className="absolute top-0 left-1/2 -translate-x-1/2 w-20 h-1 bg-amber-300/50 rounded-b-full"></div>
                         <div className="w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4 text-amber-600 text-xl shadow-md border border-amber-200">
                            <i className="fa-solid fa-quote-right"></i>
                         </div>
                         <h4 className="font-black text-amber-800 text-sm uppercase tracking-widest mb-4">حكمة اليوم للمسؤولية الأخلاقية</h4>
                         <p className="text-lg md:text-2xl font-black text-amber-900 leading-relaxed font-cairo">
                           "{section.climateWisdom}"
                         </p>
                         <p className="mt-4 text-[10px] text-amber-600/70 font-bold uppercase tracking-wider">- انقر للإغلاق -</p>
                       </div>
                     </div>
                   )}
                </div>
              )}

              {section.interactiveActivities && (
                <div className="mt-12 md:mt-16 relative">
                  <div className="absolute -top-10 md:-top-12 right-1/2 translate-x-1/2 md:translate-x-0 md:right-16 bg-white border-4 border-primary px-6 md:px-10 py-3 md:py-4 rounded-[1.5rem] md:rounded-[2rem] font-black text-accent shadow-2xl z-20 flex items-center gap-3 md:gap-4 w-max">
                    <div className="w-8 h-8 md:w-10 md:h-10 bg-primary text-white rounded-xl flex items-center justify-center shadow-lg text-sm md:text-base">
                      <i className="fa-solid fa-vial-circle-check"></i>
                    </div>
                    <div className="text-right">
                      <span className="block text-[9px] md:text-[10px] text-gray-400 uppercase tracking-tighter">مختبر العمل</span>
                      <span className="text-xs md:text-base">تطبيق عملي للمسؤولية</span>
                    </div>
                  </div>
                  
                  <div className={`bg-slate-50 rounded-[2.5rem] md:rounded-[5rem] p-6 md:p-16 border-4 border-dashed transition-all duration-700 pt-16 md:pt-16 ${isAllDone ? 'border-primary bg-emerald-50/30' : 'border-gray-200'}`}>
                     
                     <div className="flex flex-col md:flex-row justify-between items-center mb-8 md:mb-12 gap-6 md:gap-0">
                        <div className="flex items-center gap-4 text-center md:text-right">
                           <div className={`w-10 h-10 md:w-12 md:h-12 rounded-2xl flex items-center justify-center text-white transition-all shadow-lg shrink-0 ${isAllDone ? 'bg-primary scale-110 rotate-[360deg]' : 'bg-gray-300'}`}>
                              <i className={`fa-solid ${isAllDone ? 'fa-award' : 'fa-hourglass-start'}`}></i>
                           </div>
                           <div>
                              <h4 className="font-black text-accent text-base md:text-lg">مستوى الإنجاز</h4>
                              <p className="text-[10px] md:text-xs font-bold text-gray-400">بصفتك معلم المستقبل، إنجازك يعني استعدادك.</p>
                           </div>
                        </div>
                        <div>
                           <span className="text-3xl font-black text-primary">{isAllDone ? '100%' : completedActivities.individual || completedActivities.group ? '50%' : '0%'}</span>
                        </div>
                     </div>

                     <div className="grid md:grid-cols-2 gap-8 md:gap-12">
                        
                        <div className={`group relative p-6 md:p-10 rounded-[2.5rem] md:rounded-[4rem] border-4 transition-all duration-500 overflow-hidden ${completedActivities.individual ? 'bg-white border-primary shadow-2xl scale-[1.01] md:scale-[1.02]' : 'bg-white/60 border-transparent hover:border-gray-200'}`}>
                          {completedActivities.individual && (
                            <div className="absolute top-4 left-4 md:top-6 md:left-6 animate-in zoom-in-50">
                              <div className="w-10 h-10 md:w-14 md:h-14 bg-primary text-white rounded-full flex items-center justify-center shadow-lg border-4 border-white">
                                <i className="fa-solid fa-check text-sm md:text-xl"></i>
                              </div>
                            </div>
                          )}
                          
                          <div className={`w-16 h-16 md:w-20 md:h-20 rounded-2xl md:rounded-3xl flex items-center justify-center text-2xl md:text-3xl mb-6 md:mb-8 shadow-xl transition-all group-hover:rotate-12 ${completedActivities.individual ? 'bg-primary text-white' : 'bg-gray-100 text-gray-400'}`}>
                            <i className={`fa-solid ${section.interactiveActivities.individual.icon || 'fa-user-graduate'}`}></i>
                          </div>
                          
                          <div className="mb-4 md:mb-6">
                            <span className="inline-block px-3 py-1 md:px-4 md:py-1.5 bg-gray-100 text-gray-500 rounded-full text-[9px] md:text-[10px] font-black uppercase mb-2 md:mb-3">مسؤولية فردية</span>
                            <h5 className="text-xl md:text-2xl font-black text-accent">{section.interactiveActivities.individual.title}</h5>
                          </div>
                          
                          <p className="text-sm md:text-base text-gray-500 font-bold mb-6 md:mb-10 leading-relaxed min-h-[60px] md:min-h-[80px]">
                            {section.interactiveActivities.individual.task}
                          </p>
                          
                          <div className="flex flex-col gap-4">
                            <button 
                              onClick={() => toggleActivity('individual')} 
                              className={`w-full py-4 md:py-5 rounded-[1.5rem] md:rounded-[2rem] text-xs md:text-sm font-black transition-all flex items-center justify-center gap-3 ${
                                completedActivities.individual 
                                  ? 'bg-primary text-white shadow-xl shadow-primary/30' 
                                  : 'bg-accent text-white hover:bg-primary shadow-xl shadow-accent/10'
                              }`}
                            >
                              <i className={`fa-solid ${completedActivities.individual ? 'fa-certificate' : 'fa-hand-peace'}`}></i>
                              {completedActivities.individual ? 'تم التعهد والإنجاز' : 'أتعهد بالعمل كمعلم مسؤول'}
                            </button>
                            {completedActivities.individual && (
                              <p className="text-center text-primary font-black text-[10px] md:text-xs animate-pulse">🌟 أحسنت! أنت الآن سفير حقيقي للعدالة المناخية.</p>
                            )}
                          </div>
                        </div>

                        <div className={`group relative p-6 md:p-10 rounded-[2.5rem] md:rounded-[4rem] border-4 transition-all duration-500 overflow-hidden ${completedActivities.group ? 'bg-white border-blue-500 shadow-2xl scale-[1.01] md:scale-[1.02]' : 'bg-white/60 border-transparent hover:border-gray-200'}`}>
                          {completedActivities.group && (
                            <div className="absolute top-4 left-4 md:top-6 md:left-6 animate-in zoom-in-50">
                              <div className="w-10 h-10 md:w-14 md:h-14 bg-blue-500 text-white rounded-full flex items-center justify-center shadow-lg border-4 border-white">
                                <i className="fa-solid fa-users-viewfinder text-sm md:text-xl"></i>
                              </div>
                            </div>
                          )}

                          <div className={`w-16 h-16 md:w-20 md:h-20 rounded-2xl md:rounded-3xl flex items-center justify-center text-2xl md:text-3xl mb-6 md:mb-8 shadow-xl transition-all group-hover:-rotate-12 ${completedActivities.group ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-400'}`}>
                            <i className={`fa-solid ${section.interactiveActivities.group.icon || 'fa-people-group'}`}></i>
                          </div>
                          
                          <div className="mb-4 md:mb-6">
                            <span className="inline-block px-3 py-1 md:px-4 md:py-1.5 bg-gray-100 text-gray-500 rounded-full text-[9px] md:text-[10px] font-black uppercase mb-2 md:mb-3">مسؤولية جماعية</span>
                            <h5 className="text-xl md:text-2xl font-black text-accent">{section.interactiveActivities.group.title}</h5>
                          </div>
                          
                          <p className="text-sm md:text-base text-gray-500 font-bold mb-6 md:mb-10 leading-relaxed min-h-[60px] md:min-h-[80px]">
                            {section.interactiveActivities.group.task}
                          </p>
                          
                          <div className="flex flex-col gap-4">
                            <button 
                              onClick={() => toggleActivity('group')} 
                              className={`w-full py-4 md:py-5 rounded-[1.5rem] md:rounded-[2rem] text-xs md:text-sm font-black transition-all flex items-center justify-center gap-3 ${
                                completedActivities.group 
                                  ? 'bg-blue-500 text-white shadow-xl shadow-blue-500/30' 
                                  : 'bg-accent text-white hover:bg-blue-500 shadow-xl shadow-accent/10'
                              }`}
                            >
                              <i className={`fa-solid ${completedActivities.group ? 'fa-award' : 'fa-users-gear'}`}></i>
                              {completedActivities.group ? 'تم العمل المشترك بنجاح' : 'تفعيل العمل الجماعي المشترك'}
                            </button>
                            {completedActivities.group && (
                              <p className="text-center text-blue-500 font-black text-[10px] md:text-xs animate-pulse">🤝 مذهل! العمل الجماعي هو مفتاح التغيير الحقيقي.</p>
                            )}
                          </div>
                        </div>
                     </div>

                     <div className="mt-8 md:mt-12 flex justify-center">
                        <a 
                          href="https://drive.google.com/drive/folders/1P9lzk1UMaDaoZiyevNsC_hFMjQ9gxyUh?usp=drive_link" 
                          target="_blank"
                          rel="noopener noreferrer"
                          className="w-full md:w-auto px-8 md:px-10 py-4 md:py-5 bg-white border-2 border-accent text-accent hover:bg-accent hover:text-white rounded-[2rem] md:rounded-[2.5rem] font-black text-xs md:text-sm transition-all flex items-center justify-center gap-4 shadow-xl shadow-accent/5 group transform hover:-translate-y-1"
                        >
                          <i className="fa-solid fa-file-signature group-hover:scale-110 transition-transform text-base md:text-lg"></i>
                          <span>عرض نماذج الأنشطة (View Activity Templates)</span>
                        </a>
                     </div>
                     
                     {isAllDone && (
                       <div className="mt-12 md:mt-16 p-6 md:p-10 bg-gradient-to-br from-primary/10 to-emerald-100/30 rounded-[2rem] md:rounded-[3rem] border-2 border-primary/20 text-center animate-in fade-in slide-in-from-bottom-6">
                          <div className="text-3xl md:text-4xl mb-4 md:mb-6">🏆</div>
                          <h4 className="text-xl md:text-2xl font-black text-primary mb-3 md:mb-4">تهانينا يا سفير المستقبل!</h4>
                          <p className="text-gray-600 font-bold max-w-2xl mx-auto text-sm md:text-lg leading-relaxed">
                            لقد أتممت كافة أنشطة هذا المختبر بنجاح. تذكر دائماً أن دورك كمعلم هو أن تزرع هذه القيم في نفوس تلاميذك.
                          </p>
                       </div>
                     )}

                     <div className="mt-8 md:mt-12 pt-6 md:pt-8 border-t border-gray-100 text-center">
                        <p className="text-[9px] md:text-[11px] font-black text-gray-400 uppercase tracking-[0.2em] md:tracking-[0.3em] flex items-center justify-center gap-2 md:gap-4">
                           <span className="w-8 md:w-12 h-0.5 bg-gray-200"></span>
                           بصمتك اليوم تبني وعي الأجيال
                           <span className="w-8 md:w-12 h-0.5 bg-gray-200"></span>
                        </p>
                     </div>
                  </div>
                </div>
              )}

              {section.sources && (
                <div className="mt-16 md:mt-24 pt-8 md:pt-10 border-t border-gray-50 flex flex-col md:flex-row items-center justify-between gap-6 md:gap-8 text-center md:text-right">
                   <div className="flex flex-col md:flex-row items-center gap-4 md:gap-6">
                      <div className="w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-primary/5 flex items-center justify-center text-primary border border-primary/10 text-2xl md:text-3xl shadow-inner">
                        <i className="fa-solid fa-graduation-cap"></i>
                      </div>
                      <div className="max-w-md">
                        <p className="text-accent font-black text-base md:text-lg mb-1">دليل المراجع الأكاديمية</p>
                        <p className="text-xs md:text-sm font-bold text-gray-400 leading-relaxed italic">تم تدقيق هذه المعلومات بناءً على تقارير الهيئة الحكومية الدولية المعنية بتغير المناخ (IPCC) ومنظمة اليونسكو.</p>
                      </div>
                   </div>
                   <button 
                     onClick={() => onShowSources(section)} 
                     className="w-full md:w-auto px-8 md:px-12 py-4 md:py-6 bg-accent text-white rounded-[2rem] md:rounded-[2.5rem] font-black text-xs md:text-sm hover:bg-primary transition-all shadow-2xl shadow-accent/10 flex items-center justify-center gap-4 group"
                   >
                     <i className="fa-solid fa-book-atlas group-hover:rotate-12 transition-transform text-base md:text-lg"></i> 
                     عرض التقارير والمصادر
                   </button>
                </div>
              )}
            </section>
          );
        };

        // --- ChatBot ---
        const ChatBot = () => {
          const [isOpen, setIsOpen] = useState(false);
          const [messages, setMessages] = useState([]);
          const [input, setInput] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const messagesEndRef = useRef(null);

          const scrollToBottom = () => {
            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          };

          useEffect(() => {
            scrollToBottom();
          }, [messages, isLoading]);

          const handleSend = async (e) => {
            e.preventDefault();
            if (!input.trim() || isLoading) return;

            const userMessage = { role: 'user', text: input.trim() };
            setMessages(prev => [...prev, userMessage]);
            setInput('');
            setIsLoading(true);

            const result = await geminiService.askAboutClimate(userMessage.text, messages);
            
            setMessages(prev => [...prev, { 
              role: 'model', 
              text: result.text, 
              groundingUrls: result.urls 
            }]);
            setIsLoading(false);
          };

          return (
            <div className="fixed bottom-4 left-4 z-[100] no-print flex flex-col items-start pointer-events-none">
              <div className="pointer-events-auto">
              {isOpen ? (
                <div className="bg-white w-full md:w-[400px] h-[60vh] md:h-[550px] rounded-[2rem] shadow-2xl flex flex-col border border-gray-100 overflow-hidden animate-in fade-in slide-in-from-bottom-8">
                  <div className="bg-primary p-4 md:p-6 text-white flex justify-between items-center shadow-lg">
                    <div className="flex items-center gap-3">
                      <div className="w-8 h-8 md:w-10 md:h-10 bg-white/20 rounded-xl flex items-center justify-center border border-white/10">
                        <i className="fa-solid fa-robot"></i>
                      </div>
                      <div>
                        <h3 className="font-black text-xs md:text-sm">المساعد الذكي للعدالة المناخية</h3>
                        <p className="text-[9px] md:text-[10px] text-white/70 font-bold uppercase">AI Smart Assistant</p>
                      </div>
                    </div>
                    <button onClick={() => setIsOpen(false)} className="hover:bg-white/10 p-2 rounded-lg transition-colors">
                      <i className="fa-solid fa-xmark"></i>
                    </button>
                  </div>

                  <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50/50">
                    {messages.length === 0 && (
                      <div className="text-center py-8 px-4">
                        <div className="w-16 h-16 bg-primary/10 text-primary rounded-full flex items-center justify-center mx-auto mb-4 text-2xl border border-primary/20">
                          <i className="fa-solid fa-robot animate-bounce"></i>
                        </div>
                        <h4 className="font-black text-accent mb-2">أهلاً بك في منصة د. مروى حسين</h4>
                        <p className="text-xs text-gray-500 font-bold leading-relaxed">أنا مساعدك الذكي، جاهز للإجابة عن أي سؤال يخص موضوعات العدالة المناخية أو مساعدتك في استكشاف الخريطة.</p>
                      </div>
                    )}
                    
                    {messages.map((m, idx) => (
                      <div key={idx} className={`flex flex-col ${m.role === 'user' ? 'items-end' : 'items-start'}`}>
                        <div className={`max-w-[90%] p-3 md:p-4 rounded-2xl text-xs md:text-sm font-bold leading-relaxed shadow-sm whitespace-pre-line ${
                          m.role === 'user' 
                            ? 'bg-primary text-white rounded-bl-none' 
                            : 'bg-white text-accent border border-gray-100 rounded-br-none'
                        }`}>
                          {m.text}
                          
                          {m.groundingUrls && m.groundingUrls.length > 0 && (
                            <div className="mt-4 pt-4 border-t border-gray-100">
                              <p className="text-[10px] text-primary font-black mb-2 uppercase">مصادر خرائط جوجل:</p>
                              <div className="flex flex-col gap-2">
                                {m.groundingUrls.map((url, i) => (
                                  <a 
                                    key={i} 
                                    href={url.uri} 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    className="text-[10px] md:text-[11px] text-blue-600 hover:underline flex items-center gap-2"
                                  >
                                    <i className="fa-solid fa-arrow-up-right-from-square text-[9px]"></i>
                                    {url.title}
                                  </a>
                                ))}
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                    
                    {isLoading && (
                      <div className="flex justify-start">
                        <div className="bg-white p-4 rounded-2xl border border-gray-100 rounded-br-none shadow-sm">
                          <div className="flex gap-1">
                            <div className="w-1.5 h-1.5 bg-primary rounded-full animate-bounce"></div>
                            <div className="w-1.5 h-1.5 bg-primary rounded-full animate-bounce [animation-delay:0.2s]"></div>
                            <div className="w-1.5 h-1.5 bg-primary rounded-full animate-bounce [animation-delay:0.4s]"></div>
                          </div>
                        </div>
                      </div>
                    )}
                    <div ref={messagesEndRef} />
                  </div>

                  <form onSubmit={handleSend} className="p-3 md:p-4 bg-white border-t border-gray-100 flex gap-2">
                    <input
                      type="text"
                      value={input}
                      onChange={(e) => setInput(e.target.value)}
                      placeholder="اسألني عن أي شيء في المنهج..."
                      className="flex-1 bg-gray-100 border-none rounded-xl px-4 py-2 text-xs md:text-sm font-bold outline-none focus:bg-gray-50 transition-colors"
                    />
                    <button 
                      type="submit"
                      disabled={isLoading}
                      className="w-10 h-10 bg-primary text-white rounded-xl flex items-center justify-center hover:bg-secondary transition-colors disabled:opacity-50 shadow-md shadow-primary/20"
                    >
                      <i className="fa-solid fa-paper-plane-rtl"></i>
                    </button>
                  </form>
                </div>
              ) : (
                <button 
                  onClick={() => setIsOpen(true)}
                  className="w-14 h-14 md:w-16 md:h-16 bg-primary text-white rounded-2xl shadow-2xl flex items-center justify-center text-xl md:text-2xl hover:scale-110 active:scale-95 transition-all group relative border-4 border-white"
                >
                  <i className="fa-solid fa-robot"></i>
                  <span className="absolute -top-2 -right-2 bg-red-500 text-[10px] font-black w-5 h-5 md:w-6 md:h-6 rounded-full border-2 border-white flex items-center justify-center animate-pulse shadow-lg">AI</span>
                  <div className="absolute right-full mr-4 bg-accent text-white py-2 px-4 rounded-xl text-xs font-bold opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none shadow-2xl border border-white/10 hidden md:block">
                    المساعد الذكي
                  </div>
                </button>
              )}
              </div>
            </div>
          );
        };

        // --- Search Context ---
        const SearchContext = createContext('');

        // ==========================================
        // 4. MAIN APP COMPONENT
        // ==========================================
        const App = () => {
          const [searchQuery, setSearchQuery] = useState('');
          const [selectedSection, setSelectedSection] = useState(null);
          const [isGuideOpen, setIsGuideOpen] = useState(false);

          const filteredSections = useMemo(() => {
            const query = searchQuery.trim().toLowerCase();
            if (!query) return SECTIONS;

            const contextMap = {
              'سياسة': ['political', 'حكم', 'دول', 'صندوق', 'دبلوماسية', 'نزاع', 'قانون'],
              'بيئة': ['environmental', 'طبيعة', 'مناخ', 'بحر', 'تصحر', 'تلوث', 'كربون', 'مياه', 'شح', 'نيل'],
              'اجتماع': ['social', 'ناس', 'بشر', 'حقوق', 'نساء', 'صحة', 'هجرة', 'فقر', 'مجتمع'],
              'اقتصاد': ['economic', 'مال', 'تمويل', 'دين', 'وظائف', 'سوق', 'استثمار', 'بنوك'],
              'تكنولوجيا': ['technological', 'تقنية', 'ذكاء', 'رقمي', 'ابتكار', 'نظام', 'تطبيق'],
              'مقدمة': ['intro', 'أساس', 'مفهوم', 'تعريف', 'مبادئ', 'تاريخ'],
            };

            return SECTIONS.filter(section => {
              const isContextMatch = Object.entries(contextMap).some(([key, keywords]) => 
                (query.includes(key) || keywords.some(k => query.includes(k))) && section.type.includes(keywords[0])
              );

              const inTitle = section.title.toLowerCase().includes(query);
              const inIntro = section.intro.toLowerCase().includes(query);
              const inPoints = section.points.some(p => 
                p.text.toLowerCase().includes(query) || 
                p.definition?.toLowerCase().includes(query) ||
                p.mapInfo?.regionName.toLowerCase().includes(query)
              );

              return isContextMatch || inTitle || inIntro || inPoints;
            });
          }, [searchQuery]);

          const handleWebSearch = () => {
            window.open(`https://www.google.com/search?q=${encodeURIComponent(searchQuery || 'العدالة المناخية')}`, '_blank');
          };

          return (
            <SearchContext.Provider value={searchQuery}>
              <div className="min-h-screen bg-background font-cairo text-accent overflow-x-hidden">
                <Navbar 
                  onSearch={setSearchQuery}
                  onWebSearch={handleWebSearch}
                  onPrint={() => window.print()}
                  onShare={() => {
                    navigator.clipboard.writeText(window.location.href);
                    alert('تم نسخ الرابط!');
                  }}
                />

                <header className="relative py-24 md:py-40 text-center bg-cover bg-center no-print overflow-hidden" style={{ backgroundImage: "url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&q=80&w=2070')" }}>
                  <div className="absolute inset-0 bg-gradient-to-b from-black/80 via-black/50 to-background/20 backdrop-blur-[1px]"></div>
                  <div className="relative z-10 max-w-5xl mx-auto px-4 md:px-6 animate-in fade-in slide-in-from-top-10 duration-1000">
                    <div className="inline-block px-4 py-1.5 bg-primary/20 backdrop-blur-md border border-primary/30 rounded-full text-primary font-black text-[10px] md:text-xs uppercase tracking-widest mb-4 md:mb-6">
                      منصة تعليمية متخصصة
                    </div>
                    <h1 className="text-3xl md:text-5xl lg:text-7xl font-black text-white mb-6 md:mb-8 drop-shadow-[0_5px_15px_rgba(0,0,0,0.5)] leading-tight">
                      <span className="text-primary bg-clip-text text-transparent bg-gradient-to-l from-primary to-emerald-300">العدالة المناخية</span>
                      <span className="block mt-2">.. الضرورة الغائبة والهدف المشترك</span>
                    </h1>
                    <p className="text-lg md:text-2xl text-white/80 mb-8 md:mb-12 leading-relaxed max-w-3xl mx-auto font-bold px-4">
                      كُن صوت العدالة.. من أجل غد مستدام
                    </p>
                    <div className="flex flex-col sm:flex-row flex-wrap justify-center gap-4 md:gap-6 px-4">
                      <button 
                        onClick={() => document.getElementById('intro')?.scrollIntoView({ behavior: 'smooth' })}
                        className="w-full sm:w-auto px-8 md:px-10 py-4 bg-primary text-white font-black rounded-2xl shadow-2xl shadow-primary/40 hover:scale-105 hover:bg-secondary active:scale-95 transition-all flex items-center justify-center gap-3"
                      >
                        <i className="fa-solid fa-layer-group"></i> استكشف المحاور
                      </button>
                      <button 
                        onClick={() => setIsGuideOpen(true)}
                        className="w-full sm:w-auto px-8 md:px-10 py-4 bg-white/10 backdrop-blur-md text-white border border-white/30 font-black rounded-2xl shadow-xl hover:bg-white/20 transition-all flex items-center justify-center gap-3 group"
                      >
                        <i className="fa-solid fa-graduation-cap group-hover:rotate-12 transition-transform"></i> دليل الطالب
                      </button>
                    </div>
                  </div>
                  
                  <div className="absolute bottom-0 left-0 right-0 h-16 md:h-32 bg-gradient-to-t from-background to-transparent"></div>
                </header>

                <main className="max-w-7xl mx-auto px-4 md:px-6 py-12 md:py-20 min-h-[500px]">
                  {searchQuery && (
                    <div className="mb-12 p-6 md:p-8 bg-white rounded-[2rem] md:rounded-[2.5rem] border border-primary/20 shadow-xl shadow-primary/5 flex flex-col md:flex-row items-center justify-between gap-6">
                      <div className="flex flex-col md:flex-row items-center gap-4 md:gap-5 text-center md:text-right">
                        <div className="w-14 h-14 rounded-2xl bg-primary/10 text-primary flex items-center justify-center text-2xl">
                          <i className="fa-solid fa-magnifying-glass"></i>
                        </div>
                        <div>
                          <p className="text-gray-400 font-bold text-sm">نتائج البحث عن:</p>
                          <p className="text-2xl md:text-3xl font-black text-accent">"{searchQuery}"</p>
                        </div>
                      </div>
                      <div className="flex flex-col sm:flex-row items-center gap-4 w-full md:w-auto">
                        <div className="text-center md:text-right">
                          <span className="block px-4 py-1 bg-primary/10 text-primary rounded-lg text-[10px] font-black uppercase mb-1">ذكاء اصطناعي نشط</span>
                          <p className="text-xs font-bold text-gray-500">وجدنا {filteredSections.length} تطابق ذكي</p>
                        </div>
                        <button 
                          onClick={() => setSearchQuery('')}
                          className="w-full sm:w-auto px-6 py-3 bg-red-50 text-red-600 rounded-xl text-sm font-black hover:bg-red-100 transition-colors"
                        >
                          إلغاء
                        </button>
                      </div>
                    </div>
                  )}

                  <div className="space-y-16 md:space-y-24">
                    {filteredSections.length > 0 ? (
                      filteredSections.map((section) => (
                        <SectionCard 
                          key={section.id} 
                          section={section} 
                          onShowSources={(sec) => setSelectedSection(sec)}
                        />
                      ))
                    ) : (
                      <div className="py-20 md:py-40 text-center bg-white rounded-[3rem] md:rounded-[4rem] border-4 border-dashed border-gray-100 shadow-inner px-4">
                        <div className="w-20 h-20 md:w-24 md:h-24 bg-gray-50 text-gray-300 rounded-full flex items-center justify-center mx-auto mb-8 md:mb-10 text-3xl md:text-4xl">
                          <i className="fa-solid fa-cloud-moon"></i>
                        </div>
                        <h3 className="text-2xl md:text-4xl font-black text-accent mb-4 md:mb-6">لم نعثر على نتائج دقيقة</h3>
                        <p className="text-gray-400 font-bold mb-8 md:mb-12 max-w-md mx-auto text-base md:text-lg leading-relaxed">
                          جرب البحث عن كلمات مختلفة مثل "تكنولوجيا"، "نيل"، أو "تغيير" لاستكشاف المحتوى.
                        </p>
                        <button 
                          onClick={() => setSearchQuery('')}
                          className="w-full sm:w-auto px-8 md:px-12 py-4 md:py-5 bg-primary text-white font-black rounded-3xl shadow-2xl shadow-primary/30 hover:scale-105 active:scale-95 transition-all"
                        >
                          الرجوع للمنهج الكامل
                        </button>
                      </div>
                    )}
                  </div>
                </main>

                <footer className="relative mt-12 md:mt-20 pt-16 md:pt-24 pb-12 overflow-hidden no-print">
                  <div className="absolute inset-0 bg-gradient-to-t from-gray-50 via-white to-white z-0"></div>
                  <div className="absolute top-0 left-1/2 -translate-x-1/2 w-3/4 h-px bg-gradient-to-r from-transparent via-primary/30 to-transparent"></div>
                  
                  <div className="max-w-4xl mx-auto px-6 relative z-10 text-center">
                    
                    <div className="inline-flex items-center justify-center w-16 h-16 md:w-20 md:h-20 rounded-[1.5rem] md:rounded-[2rem] bg-white border border-gray-100 shadow-xl shadow-gray-200/50 mb-6 md:mb-8 transform hover:scale-110 transition-transform duration-500">
                       <i className="fa-solid fa-pen-nib text-2xl md:text-3xl text-primary"></i>
                    </div>

                    <h3 className="text-[10px] md:text-xs font-black text-primary uppercase tracking-[0.2em] mb-4">
                      إعداد وتصميم المحتوى العلمي والمنصة الالكترونية
                    </h3>

                    <h1 className="text-3xl md:text-5xl font-black text-accent mb-6">
                      دكتورة / مروى حسين إسماعيل
                    </h1>

                    <div className="inline-flex flex-col md:flex-row items-center gap-3 md:gap-6 bg-white px-6 md:px-8 py-4 rounded-[2rem] border border-gray-100 shadow-lg mb-12 hover:shadow-xl transition-shadow w-full md:w-auto">
                       <div className="flex items-center gap-2">
                         <i className="fa-solid fa-user-graduate text-gray-400"></i>
                         <span className="text-gray-600 font-bold text-xs md:text-sm">أستاذ المناهج وطرق التدريس</span>
                       </div>
                       <div className="hidden md:block w-1.5 h-1.5 bg-gray-300 rounded-full"></div>
                       <div className="flex items-center gap-2">
                         <i className="fa-solid fa-building-columns text-gray-400"></i>
                         <span className="text-gray-600 font-bold text-xs md:text-sm">كلية التربية - جامعة عين شمس</span>
                       </div>
                    </div>

                    <div className="pt-8 border-t border-gray-100 flex flex-col items-center justify-center gap-2 text-gray-400 text-[10px] md:text-xs font-bold">
                       <p>جميع الحقوق محفوظة &copy; {new Date().getFullYear()} - منصة العدالة المناخية</p>
                       <p>منصة مخصصة لتعزيز المسئولية الاخلاقية والاتجاه نحو العمل المناخي لدى الطلاب المعلمين بكليات التربية</p>
                    </div>

                  </div>
                </footer>

                {selectedSection && (
                  <div className="fixed inset-0 z-[110] flex items-center justify-center p-4 bg-accent/60 backdrop-blur-sm animate-in fade-in">
                    <div className="bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl p-6 md:p-8 relative overflow-hidden">
                      <div className="absolute top-0 right-0 w-24 h-2 bg-primary"></div>
                      <button 
                        onClick={() => setSelectedSection(null)}
                        className="absolute top-6 left-6 text-gray-300 hover:text-accent transition-colors"
                      >
                        <i className="fa-solid fa-xmark text-2xl"></i>
                      </button>
                      <h3 className="text-2xl font-black text-accent mb-6">المراجع والتقارير الدولية المعتمدة</h3>
                      <div className="space-y-4 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
                        {selectedSection.sources?.map((s, i) => (
                          <a 
                            key={i} 
                            href={s.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="flex items-center gap-4 p-5 bg-gray-50 rounded-2xl hover:bg-primary/10 hover:border-primary/20 border-2 border-transparent transition-all group"
                          >
                            <div className="w-10 h-10 rounded-xl bg-primary/10 text-primary flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-colors">
                              <i className="fa-solid fa-link"></i>
                            </div>
                            <div className="flex-1">
                              <span className="text-sm font-black text-gray-700 block mb-0.5">{s.name}</span>
                              <span className="text-[10px] text-gray-400 font-bold uppercase tracking-wider group-hover:text-primary transition-colors">عرض التقرير الرسمي <i className="fa-solid fa-arrow-up-right-from-square ml-1"></i></span>
                            </div>
                          </a>
                        ))}
                      </div>
                    </div>
                  </div>
                )}

                {isGuideOpen && (
                  <div className="fixed inset-0 z-[120] flex items-center justify-center p-4 bg-accent/80 backdrop-blur-md animate-in fade-in">
                    <div className="bg-white w-full max-w-2xl rounded-[2.5rem] md:rounded-[3.5rem] shadow-[0_35px_60px_-15px_rgba(0,0,0,0.3)] p-6 md:p-10 relative overflow-hidden flex flex-col max-h-[90vh]">
                      <div className="absolute top-0 right-0 w-full h-2 bg-gradient-to-l from-primary to-secondary"></div>
                      
                      <button 
                        onClick={() => setIsGuideOpen(false)}
                        className="absolute top-6 left-6 md:top-8 md:left-8 w-10 h-10 md:w-12 md:h-12 rounded-full bg-slate-100 flex items-center justify-center text-slate-400 hover:text-red-500 hover:bg-red-50 transition-all"
                      >
                        <i className="fa-solid fa-xmark text-lg md:text-xl"></i>
                      </button>

                      <div className="mb-6 md:mb-8 mt-4 md:mt-0">
                        <div className="flex items-center gap-3 md:gap-4 mb-4">
                          <div className="w-12 h-12 md:w-14 md:h-14 bg-primary/10 rounded-2xl flex items-center justify-center text-primary text-xl md:text-2xl border border-primary/20">
                            <i className="fa-solid fa-graduation-cap"></i>
                          </div>
                          <h3 className="text-2xl md:text-3xl font-black text-accent">دليل الطالب</h3>
                        </div>
                        <p className="text-slate-500 font-bold text-base md:text-lg leading-relaxed">
                          عزيزي الطالب، أنت "سفير المستقبل" وصانع الوعي في الأجيال القادمة.
                        </p>
                      </div>

                      <div className="flex-1 overflow-y-auto space-y-4 md:space-y-6 pr-2 custom-scrollbar pb-6">
                        <div className="p-5 md:p-6 bg-emerald-50 rounded-[2rem] md:rounded-[2.5rem] border border-emerald-100">
                          <h4 className="font-black text-primary mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base">
                            <i className="fa-solid fa-map-signs"></i> رحلة التعلم المستدام
                          </h4>
                          <p className="text-xs md:text-sm font-bold text-slate-600 leading-relaxed">
                            ابدأ باستكشاف "الأبعاد البيئية" لتعرف حجم التحدي، ثم انتقل عبر المسارات "السياسية والاقتصادية" لتفهم آليات القرار.
                          </p>
                        </div>

                        <div className="p-5 md:p-6 bg-blue-50 rounded-[2rem] md:rounded-[2.5rem] border border-blue-100">
                          <h4 className="font-black text-blue-600 mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base">
                            <i className="fa-solid fa-scale-balanced"></i> ميثاق الالتزام الأخلاقي
                          </h4>
                          <p className="text-xs md:text-sm font-bold text-slate-600 leading-relaxed">
                            بصفتك معلماً مستقبلياً، يقع على عاتقك غرس قيم "الإنصاف" و"المسؤولية المشتركة".
                          </p>
                        </div>

                        <div className="p-5 md:p-6 bg-amber-50 rounded-[2rem] md:rounded-[2.5rem] border border-amber-100">
                          <h4 className="font-black text-amber-600 mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base">
                            <i className="fa-solid fa-chalkboard-user"></i> الأثر التربوي الممتد
                          </h4>
                          <p className="text-xs md:text-sm font-bold text-slate-600 leading-relaxed">
                            غايتك امتلاك المهارة لتبسيط هذه المفاهيم المعقدة ونقلها لتلاميذك.
                          </p>
                        </div>
                      </div>

                      <div className="mt-4 md:mt-6 pt-4 md:pt-6 border-t border-slate-100 flex justify-center shrink-0">
                        <button 
                          onClick={() => {
                            setIsGuideOpen(false);
                            document.getElementById('intro')?.scrollIntoView({ behavior: 'smooth' });
                          }}
                          className="w-full md:w-auto px-10 md:px-12 py-4 bg-primary text-white font-black rounded-2xl shadow-xl hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-3"
                        >
                          أنا مستعد للبدء الآن <i className="fa-solid fa-arrow-left"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
             <ChatBot />   
            </SearchContext.Provider>
          );
        };

        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(<App />);
    </script>
</body>
</html>
